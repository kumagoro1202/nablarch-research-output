---
name: adr-creator
description: 分析レポート群から数値的エビデンスを自動抽出し、ADR（Architecture Decision Record）ドキュメントを生成する。「○○の技術選定をADRにまとめて」「分析レポートからアーキテクチャ決定を文書化して」「○○ vs △△の比較をADRとして記録して」といった要望に対応する。複数の分析レポートを入力として受け取り、コンテキスト構築・代替案抽出・比較表生成・影響分析を経て、数値的根拠付きの完全なADRを出力する。ADR番号の自動採番、ステータスライフサイクル管理、品質チェックリストを含む。
---

# ADR Creator

## Overview

分析レポート群（コミュニティ調査、技術比較、ベンチマーク結果等）を入力として受け取り、アーキテクチャ上の意思決定を構造化されたADR（Architecture Decision Record）ドキュメントとして出力するスキル。

ADRは、ソフトウェアアーキテクチャにおける重要な意思決定を記録し、その背景・代替案・根拠・影響を将来の開発者にも理解可能な形で残すための文書である。本スキルは、既存の分析レポートから数値的エビデンス（GitHub Stars数、ベンチマーク結果、コミュニティ規模、求人数等）を自動抽出し、客観的根拠に基づいたADRを生成する。

**本スキルの特長:**
- 分析レポートからの数値的エビデンス自動抽出
- 代替案の自動識別と比較表の自動生成
- 定量的 + 定性的な多角比較の実施
- 影響分析フレームワーク（スコープ・リスク・コスト・タイムライン）の適用
- ADR番号の自動採番（既存ADRスキャンによるインクリメント）
- ステータスライフサイクル管理（proposed → accepted → deprecated → superseded）
- 品質チェックリストによる自動検証

**用途:**
- 技術選定の意思決定記録
- アーキテクチャパターンの採用判断の文書化
- フレームワーク・ライブラリ選定の根拠記録
- マイグレーション/リプレース判断の文書化
- RAGナレッジベースの意思決定記録パート

**実績:**
- cmd_023において、ashigaru7がADR-001（RAG-Enhanced MCPサーバーアーキテクチャの採用）を約194行で作成
- 6本の分析レポート（O-001, O-002, O-005, O-006, O-022, O-023）から数値的根拠を抽出
- 3つの代替パターンの比較表を含む包括的なADRを生成

## When to Use

以下のいずれかに該当する場合にこのスキルを使用する：

- 「○○の技術選定をADRにまとめて」
- 「分析レポートから意思決定を文書化して」
- 「○○ vs △△ vs □□の比較をADRとして記録して」
- 「アーキテクチャの決定理由を記録して」
- 「○○を採用した根拠をADRに残して」
- 「技術調査レポートからADRを自動生成して」
- 「既存のADRを更新して（superseded/deprecated）」
- 分析レポートが複数存在し、そこから意思決定を抽出・文書化する必要がある場合
- 数値的エビデンスに基づいた客観的な意思決定記録が求められる場合
- 将来の開発者が意思決定の背景を理解できる記録が必要な場合

**トリガーキーワード**: ADR, アーキテクチャ決定記録, 技術選定記録, 意思決定記録, Decision Record, 採用判断, 比較文書化

## Instructions

### Phase 1: 入力分析（分析レポートの読み込みとデータ抽出）

分析レポート群を読み込み、意思決定に関連するデータを体系的に抽出する。

#### Step 1.1: 分析レポートの特定と読み込み

```
【入力レポートの特定】

1. 指定されたレポートファイルを全て読み込む
   Read: {report_files} の各ファイル（並列実行可能）

2. レポートが指定されていない場合、関連ディレクトリをスキャン
   Glob: output/*.md
   Glob: output/**/*.md
   Glob: reports/*.md

3. 各レポートのメタデータを確認
   - レポートID（O-001, O-002 等）
   - 作成日
   - 対象技術
   - レポート種別（コミュニティ調査/技術比較/ベンチマーク/設計分析等）

【実践知見 — ADR-001作成時の実績】
- 6本の分析レポートを入力として使用:
  - O-001: コミュニティ・ユーザー情報調査レポート
  - O-002: Fintan公式コンテンツ分析レポート
  - O-005: フレームワーク横断知識ベース
  - O-006: 技術比較レポート
  - O-022: RAGシステム計画書
  - O-023: MCP対応RAGサーバー設計書
- 各レポートから意思決定に直結するデータを選択的に抽出
```

#### Step 1.2: 数値的エビデンスの自動抽出

```
【抽出対象パターン — 正規表現ベース】

1. 統計数値パターン
   - GitHub Stars: /Stars?:?\s*[\d,]+/
   - フォーク数: /Forks?:?\s*[\d,]+/
   - コントリビューター数: /Contributors?:?\s*[\d,]+/
   - リポジトリ数: /repos?:?\s*[\d,]+/
   - 記事数: /(\d+)\s*件/
   - ダウンロード数: /downloads?:?\s*[\d,]+/

2. テーブル内数値パターン
   - Markdownテーブルの行をパース: /\|.*\|.*\|/
   - 数値を含むセルを特定: /[\d,]+\.?\d*/
   - ヘッダーと対応付けて構造化データに変換

3. ベンチマーク結果パターン
   - 応答時間: /(\d+\.?\d*)\s*(ms|秒|seconds?)/
   - スループット: /(\d+\.?\d*)\s*(req\/s|TPS|RPS)/
   - レイテンシ: /p\d+:?\s*(\d+\.?\d*)\s*ms/
   - メモリ使用量: /(\d+\.?\d*)\s*(MB|GB|MiB|GiB)/

4. コスト・料金パターン
   - 月額: /月額?\s*[\$￥¥]?[\d,]+/
   - 年額: /年額?\s*[\$￥¥]?[\d,]+/
   - 時間単価: /[\$￥¥][\d.]+\s*\/\s*(hour|時間)/

5. 評価スコアパターン
   - 信頼度: /(高|中|低)\s*[/／]\s*(high|medium|low)?/
   - 深刻度: /深刻度:?\s*(高|中|低)/
   - レーティング: /(\d+\.?\d*)\s*\/\s*(\d+)/

【出力形式 — 抽出結果の構造化】
各エビデンスについて以下を記録:
- 数値: 具体的な数値
- 単位: 数値の単位（Stars, 件, ms, 円等）
- コンテキスト: その数値が何を意味するか
- 出典: レポートIDとセクション
- 比較基準: 他技術の同指標値（あれば）
- 鮮度: データの取得日

【実践知見 — ADR-001で実際に抽出したエビデンス】
- GitHub Stars: 42（Nablarch） vs 76,000（Spring Boot）
- Qiita記事: 14件（Nablarch） vs 数千件（Spring）
- 公開リポジトリ: 114（nablarchオーガニゼーション）
- CVE: 2件（CVE-2019-5918, CVE-2019-5919）
- 公開求人: ほぼ0件（Nablarch名指し）
- Fintan学習コンテンツ: 開発標準一式
```

#### Step 1.3: 定性的データの抽出

```
【抽出対象】

1. 良い点/メリット
   - レポート内の「良い点」「メリット」「利点」セクションから抽出
   - サマリテーブルがある場合はそこから優先的に取得
   - 信頼度情報も併せて記録

2. 課題点/デメリット
   - レポート内の「課題点」「デメリット」「問題点」セクションから抽出
   - 深刻度情報も併せて記録

3. 技術的制約・前提条件
   - 「前提条件」「制約」「要件」に関する記述を抽出
   - アーキテクチャ上の制約（言語、フレームワーク、インフラ等）

4. ステークホルダーの関心事
   - 開発者の評価コメント
   - 企業/組織の方針に関する記述
   - ビジネス要件に関する記述

5. リスク要因
   - セキュリティ脆弱性情報
   - コミュニティ規模に関するリスク
   - ベンダーロックインリスク
   - 技術的負債リスク

【カテゴリ分類】
各データに以下のタグを付与:
- [TECH]: 技術的メリット/デメリット
- [COMM]: コミュニティ関連
- [SEC]: セキュリティ関連
- [COST]: コスト関連
- [RISK]: リスク関連
- [BIZ]: ビジネス関連
```

### Phase 2: コンテキスト構築（問題文・ステークホルダー・制約の整理）

ADRの「Context」セクションを構成するための情報を整理し、意思決定の背景を明確にする。

#### Step 2.1: 問題文の定義

```
【問題文テンプレート】

「{プロジェクト/システム名}において、{具体的な課題/要件}を解決するために、
{技術的な意思決定の対象}を決定する必要がある。」

【問題文の構成要素】
1. 背景: なぜこの意思決定が必要になったのか
2. スコープ: 何を決定するのか（具体的な技術領域）
3. 制約: 意思決定に影響する制約条件
4. 期待される結果: この決定によって何が実現されるべきか

【数値的根拠の挿入ポイント】
問題文には必ず数値的根拠を含める:
- 「現在の{指標}は{数値}であり...」
- 「{技術A}のコミュニティ規模（GitHub Stars: {N}）を考慮すると...」
- 「{N}件の分析レポートの調査結果に基づき...」

【実践知見 — ADR-001のContext構成】
問題文:
「Nablarch開発支援のためのAIアシスタント構築において、
最適なアーキテクチャパターンを決定する必要がある。
Nablarchは独自のアーキテクチャ（ハンドラキュー等）を持ち、
コミュニティ規模が限定的（GitHub Stars: 42, Qiita記事: 14件）であるため、
汎用LLMの知識だけでは不十分であり、専門的な知識ベースの構築が必須である。」
```

#### Step 2.2: ステークホルダーの特定

```
【ステークホルダー分析テンプレート】

| ステークホルダー | 役割 | 関心事 | 影響度 |
|---------------|------|--------|--------|
| {名称} | {プロジェクト内の役割} | {意思決定に対する関心事} | 高/中/低 |

【典型的なステークホルダー】
1. 開発チーム
   - 関心事: 開発効率、学習コスト、ツールの使いやすさ
   - 影響度: 高（日常的に使用するため）

2. アーキテクト
   - 関心事: 拡張性、保守性、技術的整合性
   - 影響度: 高（設計方針に直結）

3. プロジェクトマネージャー
   - 関心事: コスト、スケジュール、リスク
   - 影響度: 中〜高

4. エンドユーザー
   - 関心事: 利便性、応答品質、可用性
   - 影響度: 中（間接的な影響）

5. 運用チーム
   - 関心事: 運用負荷、監視、障害対応
   - 影響度: 中

6. 経営層/意思決定者
   - 関心事: ROI、戦略的整合性、競争優位性
   - 影響度: 高（最終承認権限）

【注意事項】
- 分析レポートに記載されたステークホルダー情報を優先的に使用
- 推測でステークホルダーを追加する場合は「想定」と明記
- decision_context で指定されたステークホルダーを必ず含める
```

#### Step 2.3: 制約条件の整理

```
【制約条件の分類】

1. 技術的制約
   - 使用言語/フレームワークの制限
   - インフラ環境の制限（クラウド/オンプレ/ハイブリッド）
   - 既存システムとの互換性要件
   - パフォーマンス要件（応答時間、スループット等）

2. ビジネス制約
   - 予算上限
   - スケジュール制約（リリース期限等）
   - ライセンス制約（OSS必須、特定ライセンス不可等）
   - 規制・コンプライアンス要件

3. 組織的制約
   - チームのスキルセット
   - 開発プロセス（アジャイル/ウォーターフォール等）
   - 既存の技術スタック（統一性の要件）
   - ベンダーとの関係性

4. 品質制約
   - セキュリティ要件（認証、暗号化等）
   - 可用性要件（SLA、冗長性等）
   - 保守性要件（ドキュメント品質、コミュニティサポート等）

【数値化可能な制約は必ず数値で記載】
- 「予算: 月額{N}円以内」
- 「応答時間: {N}ms以内」
- 「可用性: {N}%以上」
- 「開発チーム: {N}名」
```

#### Step 2.4: 評価基準の定義

```
【評価基準テンプレート】

意思決定に使用する評価基準を定義し、重み付けを行う。

| # | 評価基準 | 説明 | 重み | 測定方法 |
|---|---------|------|------|---------|
| 1 | {基準名} | {基準の説明} | {1-5} | {数値/定性} |

【典型的な評価基準】
1. 技術的適合性 — 要件との合致度（重み: 5）
2. コミュニティ/エコシステム — サポート体制の充実度（重み: 4）
3. 学習コスト — チームの習得容易性（重み: 3）
4. コスト — 導入・運用コスト（重み: 4）
5. 拡張性 — 将来の要件変更への対応力（重み: 3）
6. セキュリティ — セキュリティ機能の充実度（重み: 4）
7. パフォーマンス — 応答性能/処理能力（重み: 3）
8. 保守性 — 長期運用のしやすさ（重み: 3）
9. 成熟度 — 技術の安定性・実績（重み: 4）
10. 移行コスト — 既存システムからの移行容易性（重み: 2）

【重み付けの根拠】
- decision_context で優先事項が指定されている場合はそれに従う
- 分析レポートで特に言及されている観点は重みを上げる
- プロジェクトの性質（新規/既存、短期/長期等）に応じて調整
```

### Phase 3: 代替案の抽出（分析レポートからの選択肢の特定）

分析レポートから検討すべき代替案（アーキテクチャパターン、技術選択肢等）を特定し、各案の特徴を整理する。

#### Step 3.1: 代替案の特定

```
【代替案の抽出方法】

1. 分析レポートから明示的に比較されている選択肢を抽出
   - 「パターンA vs パターンB vs パターンC」形式の比較
   - 「Option 1 / Option 2 / Option 3」形式の列挙
   - テーブル形式での比較（列ヘッダーが代替案名）

2. 暗黙的に言及されている選択肢も抽出
   - 「○○という方法もあるが...」
   - 「代替として○○が考えられる」
   - 「○○と比較して」

3. decision_context で指定された選択肢を含める

4. 業界標準の代替案を補完
   - 分析レポートに記載がなくても、一般的に比較すべき選択肢は追加
   - 追加した場合は「レポート外から補完」と明記

【代替案の最小数】
- 最低3案を提示することを推奨
- 2案の場合は「他の代替案を検討したが、以下の理由で除外した」と記載
- 4案以上の場合は主要3案 + その他として整理

【実践知見 — ADR-001で検討した代替案】
3つのパターンを検討:
1. パターンA: 静的ドキュメントサーバー方式
   - Fintan/GitHub上のドキュメントをそのまま配信
2. パターンB: RAG-Enhanced MCPサーバー方式（採用）
   - ベクトルDBによる意味検索 + MCPプロトコル統合
3. パターンC: Fine-tuned専用モデル方式
   - Nablarch特化のLLMファインチューニング
```

#### Step 3.2: 各代替案の詳細記述

```
【各代替案の記述テンプレート】

### 代替案{N}: {案の名称}

**概要**: {1-2文の説明}

**アーキテクチャ特性**:
- 構成要素: {主要コンポーネント}
- データフロー: {入力 → 処理 → 出力}
- 技術スタック: {使用技術}

**メリット**:
- {メリット1}（数値根拠: {出典}）
- {メリット2}（数値根拠: {出典}）

**デメリット**:
- {デメリット1}（数値根拠: {出典}）
- {デメリット2}（数値根拠: {出典}）

**適用条件**:
- この案が最適となる条件: {条件}
- この案が不適となる条件: {条件}

**数値的エビデンス**:
| 指標 | 値 | 出典 |
|------|-----|------|
| {指標名} | {値} | {レポートID} |

【注意事項】
- 各案のメリット/デメリットは対称的に記述する（同じ観点で比較可能にする）
- 数値的根拠がない項目は「定量データなし」と明記
- 推測は「推定」「想定」と明記
```

#### Step 3.3: 不採用案の除外理由

```
【除外理由テンプレート】

検討したが代替案として採用しなかった選択肢がある場合、以下の形式で記録する。

### 除外した選択肢

| 選択肢 | 除外理由 | 備考 |
|--------|---------|------|
| {選択肢名} | {具体的な除外理由} | {将来的な再検討可能性} |

【除外理由の典型パターン】
- 技術的制約: 「{言語/FW}との互換性がない」
- コスト制約: 「月額{N}円を超える」
- スキル制約: 「チームに{技術}の経験者がいない」
- 成熟度不足: 「本番環境での実績が不十分」
- ライセンス問題: 「{ライセンス}は使用要件に合致しない」
- スケジュール制約: 「導入に{N}ヶ月以上かかる」
```

### Phase 4: 比較表の自動生成（定量 + 定性の多角比較）

代替案を定量的・定性的に比較する表を自動生成する。

#### Step 4.1: 定量比較表の生成

```
【定量比較表テンプレート】

| 評価指標 | {代替案A} | {代替案B} | {代替案C} | 出典 |
|---------|----------|----------|----------|------|
| コミュニティ規模 | {数値} | {数値} | {数値} | {レポートID} |
| 学習コスト（推定） | {高/中/低} | {高/中/低} | {高/中/低} | {レポートID} |
| 初期導入コスト | {数値}円 | {数値}円 | {数値}円 | {レポートID} |
| 月間運用コスト | {数値}円 | {数値}円 | {数値}円 | {レポートID} |
| 応答速度 | {数値}ms | {数値}ms | {数値}ms | {レポートID} |
| セキュリティリスク | {高/中/低} | {高/中/低} | {高/中/低} | {レポートID} |
| 拡張性 | {評価} | {評価} | {評価} | {レポートID} |

【定量比較の自動生成手順】

1. Phase 1で抽出した数値的エビデンスを代替案ごとに分類
2. 同じ指標で比較可能な数値を横並びにする
3. 数値が存在しない場合は「N/A」と記載し、定性的な推定を注記
4. 出典レポートIDを全セルに付記

【スコアリング方式（オプション）】
重み付きスコアを算出する場合:

| 評価基準 | 重み | {案A}スコア | {案B}スコア | {案C}スコア |
|---------|------|-----------|-----------|-----------|
| {基準1} | {W1} | {S1a}/5 | {S1b}/5 | {S1c}/5 |
| {基準2} | {W2} | {S2a}/5 | {S2b}/5 | {S2c}/5 |
| ... | ... | ... | ... | ... |
| **加重合計** | — | **{ΣWi×Sia}** | **{ΣWi×Sib}** | **{ΣWi×Sic}** |

スコアリング基準:
- 5: 非常に優れている / 完全に適合
- 4: 優れている / 概ね適合
- 3: 普通 / 部分的に適合
- 2: やや劣る / 一部不適合
- 1: 大きく劣る / 不適合

【実践知見 — ADR-001の比較表】
3パターンを以下の観点で比較:
- 開発コスト: 低/中/高
- 回答精度: 低/高/最高
- 保守性: 高/中/低
- 拡張性: 低/高/中
- 運用コスト: 最低/中/高
- 導入速度: 最速/中/最遅
- リアルタイム性: 低/中/高
- Claude Code統合: 困難/最適/困難
- コスト効率: 低/中/低
```

#### Step 4.2: 定性比較表の生成

```
【定性比較表テンプレート】

| 観点 | {代替案A} | {代替案B} | {代替案C} |
|------|----------|----------|----------|
| アーキテクチャの単純さ | {評価と根拠} | {評価と根拠} | {評価と根拠} |
| チームスキルとの整合性 | {評価と根拠} | {評価と根拠} | {評価と根拠} |
| 将来の技術トレンド対応 | {評価と根拠} | {評価と根拠} | {評価と根拠} |
| ベンダーロックインリスク | {評価と根拠} | {評価と根拠} | {評価と根拠} |
| エコシステム成熟度 | {評価と根拠} | {評価と根拠} | {評価と根拠} |

【定性評価の記述ルール】
- 各セルは「評価（1-2語）: 根拠（1文）」の形式
- 例: 「高: MCPプロトコルの標準化により多様なIDE統合が可能」
- 根拠には可能な限りレポートからの引用を含める
- 主観的判断は「推定」と明記する
```

#### Step 4.3: SWOT分析の生成（オプション）

```
【SWOT分析テンプレート — 各代替案について】

#### {代替案名} SWOT分析

| | 好影響 | 悪影響 |
|---|-------|-------|
| **内部要因** | **Strengths（強み）** | **Weaknesses（弱み）** |
| | - {強み1} | - {弱み1} |
| | - {強み2} | - {弱み2} |
| **外部要因** | **Opportunities（機会）** | **Threats（脅威）** |
| | - {機会1} | - {脅威1} |
| | - {機会2} | - {脅威2} |

【SWOT分析の作成基準】
- 3案以上の場合: 採用候補の上位2案についてSWOT分析を実施
- 2案の場合: 両案についてSWOT分析を実施
- depth: quick の場合: SWOT分析は省略可
```

### Phase 5: 意思決定の文書化（採用案の選定と根拠の記述）

比較結果に基づき、採用する案を決定し、その根拠を数値的エビデンス付きで記述する。

#### Step 5.1: 決定事項の記述

```
【決定事項テンプレート】

## Decision（決定）

{代替案X}: {案の名称} を採用する。

### 決定の根拠

本決定は以下の根拠に基づく:

1. **{根拠1のカテゴリ}**: {具体的な根拠の記述}
   - エビデンス: {数値データ}（出典: {レポートID}）
   - 比較: {他の案との差分}

2. **{根拠2のカテゴリ}**: {具体的な根拠の記述}
   - エビデンス: {数値データ}（出典: {レポートID}）
   - 比較: {他の案との差分}

3. **{根拠3のカテゴリ}**: {具体的な根拠の記述}
   - エビデンス: {数値データ}（出典: {レポートID}）

【根拠記述のルール】
- 最低3つの根拠を提示すること
- 各根拠には数値的エビデンスを含めること
- エビデンスが定性的な場合は「複数の情報源が一致して指摘」等の形式で記述
- 決定に至った思考プロセスを論理的に説明すること

【エビデンス引用形式】
数値的エビデンスの引用は以下の形式を統一する:

- 直接数値引用: 「GitHub Stars: 42（O-001より）」
- 範囲引用: 「月額コスト: 5,000〜15,000円（O-022の試算より）」
- 比較引用: 「Spring Boot（76k Stars）と比較して約1/1800の規模（O-001より）」
- 統計引用: 「Qiita記事14件中、入門記事が10件（71%）を占める（O-001より）」
- 定性引用: 「複数の開発者が学習コストの高さを指摘（O-001, O-002より）」

【実践知見 — ADR-001の決定根拠】
「RAG-Enhanced MCPサーバー方式を採用する」

根拠:
1. Nablarchの独自アーキテクチャ（ハンドラキュー等）は
   汎用LLMの学習データに含まれない → RAGによる知識補完が必須
2. MCPプロトコルはClaude Codeとの統合が最も容易
   → 開発者のワークフローに自然に組み込める
3. コスト効率: Fine-tuning方式（月額数十万円）に対し
   RAG方式は月額5,000〜15,000円で運用可能
4. 拡張性: 新ドキュメント追加がベクトルDB更新のみで完了
   → Fine-tuning方式の再学習コスト不要
```

#### Step 5.2: 不採用案の棄却理由

```
【棄却理由テンプレート】

### 不採用とした代替案

#### {代替案Y}: {案の名称}
**棄却理由**: {主要な棄却理由の要約（1-2文）}

詳細:
- {棄却理由1}: {具体的な説明}（エビデンス: {数値}、出典: {レポートID}）
- {棄却理由2}: {具体的な説明}
- {将来的な再検討条件}: 「{条件}が変化した場合、再検討の価値がある」

#### {代替案Z}: {案の名称}
**棄却理由**: {主要な棄却理由の要約}
...

【棄却理由の記述ルール】
- 各案について最低2つの棄却理由を記載
- 棄却理由は採用案との比較で記述（「○○案と比較して」）
- 将来的な再検討条件を可能な限り記載（ADRが陳腐化した際の判断材料）
- 「完全に不適」ではなく「現時点の条件では不適」という表現を推奨
```

#### Step 5.3: 決定のトレードオフの明示

```
【トレードオフ記述テンプレート】

### この決定に伴うトレードオフ

本決定により以下のトレードオフを受け入れる:

| 得られるもの | 失うもの/受け入れるリスク |
|------------|----------------------|
| {メリット1} | {対応するデメリット/リスク} |
| {メリット2} | {対応するデメリット/リスク} |
| {メリット3} | {対応するデメリット/リスク} |

### リスク軽減策

| リスク | 軽減策 | 優先度 |
|--------|--------|--------|
| {リスク1} | {軽減策の説明} | 高/中/低 |
| {リスク2} | {軽減策の説明} | 高/中/低 |

【注意事項】
- トレードオフのないADRは疑わしい（見落としがないか再確認）
- 「全てにおいて最善」は通常あり得ない
- リスク軽減策は具体的かつ実行可能なものを記載
```

### Phase 6: 影響分析（ポジティブ・ネガティブ・ニュートラル影響の評価）

採用した意思決定が及ぼす影響を多角的に分析する。

#### Step 6.1: 影響の分類と評価

```
【影響分析テンプレート】

## Consequences（影響・結果）

### ポジティブな影響（Positive）

| # | 影響領域 | 影響内容 | 定量的効果 | 影響度 |
|---|---------|---------|-----------|--------|
| P1 | {領域} | {内容} | {数値で表せる場合} | 高/中/低 |
| P2 | {領域} | {内容} | {数値で表せる場合} | 高/中/低 |

### ネガティブな影響（Negative）

| # | 影響領域 | 影響内容 | 想定リスク | 影響度 | 軽減策 |
|---|---------|---------|-----------|--------|--------|
| N1 | {領域} | {内容} | {リスク} | 高/中/低 | {軽減策} |
| N2 | {領域} | {内容} | {リスク} | 高/中/低 | {軽減策} |

### ニュートラルな影響（Neutral）

| # | 影響領域 | 影響内容 | 備考 |
|---|---------|---------|------|
| U1 | {領域} | {内容} | {追加説明} |

【影響領域の分類】
1. アーキテクチャ: システム構成、コンポーネント間の関係
2. 開発プロセス: 開発フロー、CI/CD、テスト戦略
3. 運用: デプロイ、監視、障害対応、スケーリング
4. チーム: スキル要件、学習コスト、組織体制
5. コスト: 初期コスト、運用コスト、ライセンスコスト
6. セキュリティ: 認証、認可、脆弱性対応
7. パフォーマンス: 応答時間、スループット、リソース使用量
8. ユーザー体験: 利便性、アクセシビリティ
9. 保守性: コードの保守性、ドキュメント品質
10. 拡張性: 将来の要件変更への対応力
```

#### Step 6.2: 影響分析フレームワーク（スコープ・リスク・コスト・タイムライン）

```
【4軸影響分析フレームワーク】

#### 1. スコープ影響（Scope Impact）

| 影響範囲 | 影響内容 | 変更量 |
|---------|---------|--------|
| 新規コンポーネント | {必要な新規開発} | {工数見積} |
| 既存システム変更 | {既存部分への影響} | {工数見積} |
| 外部連携変更 | {外部サービスとの連携変更} | {工数見積} |
| ドキュメント更新 | {更新が必要なドキュメント} | {ページ数} |
| テスト追加 | {追加テストケース} | {ケース数} |

#### 2. リスク影響（Risk Impact）

| リスク分類 | リスク内容 | 発生確率 | 影響度 | リスクスコア | 対策 |
|-----------|----------|---------|--------|------------|------|
| 技術リスク | {内容} | 高/中/低 | 高/中/低 | {確率×影響} | {対策} |
| 運用リスク | {内容} | 高/中/低 | 高/中/低 | {確率×影響} | {対策} |
| ビジネスリスク | {内容} | 高/中/低 | 高/中/低 | {確率×影響} | {対策} |
| 人的リスク | {内容} | 高/中/低 | 高/中/低 | {確率×影響} | {対策} |

リスクスコア算出:
- 高 × 高 = 9（最優先対応）
- 高 × 中 = 6（優先対応）
- 中 × 中 = 4（計画的対応）
- 低 × 低 = 1（受容可能）

#### 3. コスト影響（Cost Impact）

| コスト項目 | 初期コスト | 月間運用コスト | 年間コスト | 備考 |
|-----------|-----------|--------------|-----------|------|
| インフラ | {金額} | {金額} | {金額} | {クラウドサービス名等} |
| ライセンス | {金額} | {金額} | {金額} | {ライセンス形態} |
| 開発工数 | {人月} | — | — | {チーム規模} |
| 学習コスト | {人月} | — | — | {研修/自習} |
| 運用工数 | — | {人時/月} | {人月/年} | {運用体制} |
| **合計** | **{合計}** | **{合計}** | **{合計}** | |

#### 4. タイムライン影響（Timeline Impact）

| フェーズ | 期間 | 主な作業 | マイルストーン |
|---------|------|---------|-------------|
| 設計・準備 | {N}週 | {作業内容} | {成果物} |
| 開発・実装 | {N}週 | {作業内容} | {成果物} |
| テスト・検証 | {N}週 | {作業内容} | {成果物} |
| デプロイ・移行 | {N}週 | {作業内容} | {成果物} |
| 安定化・最適化 | {N}週 | {作業内容} | {成果物} |
| **合計** | **{N}週** | | |

【注意事項】
- 数値が不明な場合は範囲で記載（例: 「3〜5人月」）
- 分析レポートに記載のある数値は出典を明記
- 推定値は「推定」と明記
```

#### Step 6.3: 影響サマリの作成

```
【影響サマリテンプレート】

### 影響サマリ

| 分析軸 | 評価 | 主な理由 |
|--------|------|---------|
| スコープ | {大/中/小} | {1文の理由} |
| リスク | {高/中/低} | {1文の理由} |
| コスト | {高/中/低} | {1文の理由} |
| タイムライン | {長/中/短} | {1文の理由} |

**総合評価**: {1-2文の総合的な影響評価}

【実践知見 — ADR-001の影響サマリ】
- ポジティブ: RAGによる高精度な回答、MCPプロトコル統合、低運用コスト
- ネガティブ: ベクトルDB運用の複雑性、Embeddingモデル選定リスク
- ニュートラル: 既存開発フローへの影響は最小限
```

### Phase 7: 最終組立（ADR番号付与・メタデータ・参照・レビュー）

全フェーズの成果物を統合し、完全なADRドキュメントとして組み立てる。

#### Step 7.1: ADR番号の自動採番

```
【ADR番号の自動採番手順】

1. 既存ADRのスキャン
   Glob: {output_dir}/ADR-*.md
   Glob: {output_dir}/**/ADR-*.md

2. 最大番号の特定
   各ファイル名からADR番号を抽出: /ADR-(\d+)/
   最大番号を取得: max_number

3. 新規ADR番号の決定
   new_number = max_number + 1
   new_adr_id = f"ADR-{new_number:03d}"
   例: ADR-001, ADR-002, ADR-003, ...

4. 既存ADRとの重複確認
   同一番号のADRが存在しないことを確認
   存在する場合はスキップして次の番号を使用

【ADR番号の特殊ケース】
- superseded ADRの場合: 新ADR番号を採番し、旧ADRに「Superseded by ADR-{new}」を追記
- 関連ADRがある場合: References セクションに「Related: ADR-{N}」を追記
- 複数プロジェクトの場合: プレフィックス追加（例: PROJ-ADR-001）

【ファイル名規則】
ADR-{番号3桁}-{タイトルのスラッグ}.md
例: ADR-001-rag-enhanced-mcp-architecture.md
    ADR-002-vector-db-selection.md
    ADR-003-embedding-model-strategy.md
```

#### Step 7.2: メタデータの付与

```
【メタデータテンプレート】

---
adr_id: ADR-{NNN}
title: "{ADRタイトル}"
status: proposed
date: {YYYY-MM-DD}
decision_makers:
  - {意思決定者1}
  - {意思決定者2}
related_adrs:
  - ADR-{関連番号}
tags:
  - {タグ1}
  - {タグ2}
source_reports:
  - {レポートID1}
  - {レポートID2}
project: {プロジェクト名}
---

【メタデータの自動生成ルール】
- adr_id: Phase 7.1で採番した番号
- title: decision_context から生成（日本語60文字以内推奨）
- status: 初期状態は必ず「proposed」
- date: 生成日（YYYY-MM-DD形式）
- decision_makers: decision_context で指定された場合のみ
- related_adrs: 参照する既存ADRがあれば
- tags: 技術名、パターン名等のキーワード
- source_reports: 入力レポートのID一覧
- project: プロジェクト名
```

#### Step 7.3: ステータスライフサイクルの管理

```
【ADRステータスライフサイクル】

┌──────────┐    承認    ┌──────────┐
│ proposed │ ────────→ │ accepted │
│ (提案中)  │           │ (承認済み) │
└──────────┘           └────┬─────┘
                            │
                   ┌────────┴────────┐
                   │                 │
              非推奨化            後継ADR作成
                   │                 │
                   ▼                 ▼
            ┌──────────┐     ┌────────────┐
            │deprecated│     │ superseded │
            │ (非推奨)  │     │ (後継あり)   │
            └──────────┘     └────────────┘

【各ステータスの定義】

1. proposed（提案中）
   - 初期状態。ADRが作成されたが、まだ承認されていない
   - レビュー中、議論中の状態
   - 変更: 内容の修正が可能

2. accepted（承認済み）
   - 意思決定が承認され、実施される状態
   - 変更: 軽微な修正のみ可能。大幅な変更は新ADRを作成

3. deprecated（非推奨）
   - 技術の陳腐化や環境変化により、この決定が推奨されなくなった状態
   - 後継ADRはないが、もう従う必要はない
   - 変更: ステータス変更のみ。内容は変更しない

4. superseded（後継あり）
   - 新しいADRによって置き換えられた状態
   - 「Superseded by ADR-{NNN}」を記載
   - 変更: ステータス変更 + 後継ADR参照の追記のみ

【ステータス変更時の操作】
- proposed → accepted:
  - statusを「accepted」に変更
  - 承認日をメタデータに追加
  - 承認者を記録

- accepted → deprecated:
  - statusを「deprecated」に変更
  - 非推奨理由を「Deprecation Note」セクションとして追記
  - 非推奨日を記録

- accepted → superseded:
  - statusを「superseded」に変更
  - 「Superseded by ADR-{NNN}」を追記
  - 後継ADRへのリンクを追加
  - 後継ADRにも「Supersedes ADR-{NNN}」を記載
```

#### Step 7.4: 参照情報の整理

```
【参照セクションテンプレート】

## References（参照情報）

### 入力分析レポート

| レポートID | タイトル | 種別 | 引用箇所数 |
|-----------|---------|------|-----------|
| {ID} | {タイトル} | {種別} | {N}箇所 |

### 関連ADR

| ADR ID | タイトル | 関係性 |
|--------|---------|--------|
| ADR-{N} | {タイトル} | {関係の説明} |

### 外部参照

| # | タイトル | URL | 参照理由 |
|---|---------|-----|---------|
| 1 | {タイトル} | {URL} | {参照理由} |

### 用語定義

| 用語 | 定義 |
|------|------|
| {用語} | {定義} |

【参照整理のルール】
- ADR本文で引用した全レポートを列挙すること
- 引用箇所数を正確にカウントすること
- 外部URL（GitHub、公式ドキュメント等）があれば追記
- 略語・専門用語は用語定義に含める
```

#### Step 7.5: 品質チェックリストの実行

```
【ADR品質チェックリスト】

ADR生成後、以下のチェックリストを全て確認してから出力する。

#### 構造チェック
- [ ] タイトルが明確で簡潔か（60文字以内推奨）
- [ ] メタデータ（YAMLフロントマター）が完全か
- [ ] Status, Context, Decision, Consequences の4セクションが全て存在するか
- [ ] References セクションが存在し、全ての引用元が列挙されているか
- [ ] ADR番号が正しく採番されているか（既存ADRとの重複なし）

#### コンテキストチェック
- [ ] 問題文が明確に記述されているか
- [ ] 意思決定の背景が十分に説明されているか
- [ ] 制約条件が明示されているか
- [ ] ステークホルダーが特定されているか

#### 代替案チェック
- [ ] 最低3つの代替案が検討されているか（2つの場合は除外理由が記載されているか）
- [ ] 各代替案のメリット/デメリットが対称的に記述されているか
- [ ] 比較表が含まれているか（定量 + 定性）
- [ ] 不採用案の棄却理由が記載されているか

#### エビデンスチェック
- [ ] 数値的エビデンスが3箇所以上引用されているか
- [ ] 全てのエビデンスに出典（レポートID）が付記されているか
- [ ] 推測と事実が明確に区別されているか
- [ ] 古いデータには時点情報が付記されているか

#### 影響分析チェック
- [ ] ポジティブ影響が記載されているか
- [ ] ネガティブ影響が記載されているか（ゼロは不自然）
- [ ] ニュートラル影響が記載されているか
- [ ] リスク軽減策が提示されているか
- [ ] 4軸影響分析（スコープ・リスク・コスト・タイムライン）が実施されているか

#### 文書品質チェック
- [ ] 一貫した文体・用語が使用されているか
- [ ] Markdownフォーマットが正しいか
- [ ] 目次と見出しが整合しているか
- [ ] 内部リンク（ADR間参照）が正しいか
- [ ] 全体の行数が100行以上か（簡易版でも）

【チェック結果の記録】
チェックリストの結果はADRの末尾にコメントとして記録する:
<!-- Quality Check: PASSED (15/15 items) -->
<!-- Generated by: adr-creator skill (S-015) -->
<!-- Check Date: YYYY-MM-DD -->
```

#### Step 7.6: 最終組立と出力

```
【ADRドキュメントの最終組立手順】

1. YAMLフロントマターの挿入
   - Phase 7.2で生成したメタデータを配置

2. タイトルの配置
   - # ADR-{NNN}: {タイトル}

3. ステータスバッジの配置
   - > **Status**: {status}
   - > **Date**: {date}
   - > **Decision Makers**: {names}

4. 目次の生成
   - 全見出しから自動生成

5. 各セクションの配置
   - Context（Phase 2の成果物）
   - Alternatives Considered（Phase 3の成果物）
   - Comparison（Phase 4の成果物）
   - Decision（Phase 5の成果物）
   - Consequences（Phase 6の成果物）
   - References（Phase 7.4の成果物）

6. 品質チェックの実行（Phase 7.5）

7. ファイルの書き出し
   Write: {output_path}/{ADR-NNN-slug}.md

8. 既存ADRの更新（superseded/deprecated の場合）
   Edit: 旧ADRのステータス更新
```

## Input Format

スキル実行時に以下のパラメータを指定する。

```yaml
# 必須パラメータ
decision_context: |
  RAG-Enhanced MCPサーバーアーキテクチャを採用するかどうかの
  技術選定を記録する。Nablarch開発支援AIアシスタントの
  最適なアーキテクチャパターンを決定する必要がある。
report_files:                              # 入力分析レポートファイルのリスト
  - "output/O-001_community_research.md"
  - "output/O-002_fintan_analysis.md"
  - "output/O-005_knowledge_base.md"
  - "output/O-006_tech_comparison.md"
  - "output/O-022_rag_plan.md"
  - "output/O-023_mcp_design.md"
output_dir: "output/adr"                   # ADR出力先ディレクトリ

# オプションパラメータ
adr_title: "RAG-Enhanced MCPサーバーアーキテクチャの採用"  # ADRタイトル（省略時は自動生成）
alternatives:                             # 事前に特定済みの代替案（省略時はレポートから自動抽出）
  - name: "静的ドキュメントサーバー方式"
    description: "Fintan/GitHub上のドキュメントをそのまま配信"
  - name: "RAG-Enhanced MCPサーバー方式"
    description: "ベクトルDBによる意味検索 + MCPプロトコル統合"
  - name: "Fine-tuned専用モデル方式"
    description: "Nablarch特化のLLMファインチューニング"
decision_makers:                          # 意思決定者（省略可）
  - "プロジェクトリード"
  - "アーキテクト"
stakeholders:                             # ステークホルダー（省略時は自動推定）
  - name: "開発チーム"
    interest: "開発効率、学習コスト"
  - name: "運用チーム"
    interest: "運用負荷、監視"
evaluation_criteria:                      # 評価基準のカスタマイズ（省略時はデフォルト使用）
  - name: "技術的適合性"
    weight: 5
  - name: "コスト効率"
    weight: 4
  - name: "拡張性"
    weight: 3
related_adrs:                             # 関連する既存ADR（省略可）
  - "ADR-000"
tags:                                     # タグ（省略可）
  - "RAG"
  - "MCP"
  - "アーキテクチャ"
depth: "standard"                         # quick / standard / thorough（デフォルト: standard）
language: "ja"                            # 出力言語（デフォルト: ja）
include_swot: false                       # SWOT分析の実施有無（デフォルト: false）
include_scoring: true                     # 重み付きスコアリングの実施有無（デフォルト: true）
status_action: "create"                   # create / supersede / deprecate（デフォルト: create）
supersedes_adr: ""                        # status_action=supersede の場合、置き換える旧ADR番号
project: "nablarch-mcp"                   # プロジェクト名（省略可）
```

### パラメータ説明

| パラメータ | 必須 | デフォルト | 説明 |
|----------|------|----------|------|
| `decision_context` | はい | -- | 意思決定の背景と目的を説明するテキスト |
| `report_files` | はい | -- | 入力分析レポートファイルのパスリスト |
| `output_dir` | はい | -- | ADR出力先ディレクトリ |
| `adr_title` | -- | 自動生成 | ADRのタイトル。省略時はdecision_contextから自動生成 |
| `alternatives` | -- | 自動抽出 | 検討する代替案のリスト。省略時はレポートから自動抽出 |
| `decision_makers` | -- | `[]` | 意思決定者の名前/役割リスト |
| `stakeholders` | -- | 自動推定 | ステークホルダーとその関心事 |
| `evaluation_criteria` | -- | デフォルト10基準 | 評価基準と重み付けのカスタマイズ |
| `related_adrs` | -- | `[]` | 関連する既存ADRの番号リスト |
| `tags` | -- | `[]` | ADRに付与するタグ |
| `depth` | -- | `standard` | 分析深度。quick=簡易版/standard=標準版/thorough=完全版 |
| `language` | -- | `ja` | 出力言語 |
| `include_swot` | -- | `false` | SWOT分析を含めるかどうか |
| `include_scoring` | -- | `true` | 重み付きスコアリングを含めるかどうか |
| `status_action` | -- | `create` | 操作種別: create=新規作成/supersede=既存ADR置換/deprecate=既存ADR非推奨化 |
| `supersedes_adr` | -- | `""` | supersede時に置き換えるADR番号 |
| `project` | -- | `""` | プロジェクト名（メタデータに使用） |

### 深度別の処理範囲

| Phase | quick | standard | thorough |
|-------|-------|----------|----------|
| 1. 入力分析 | 主要レポートのみ | 全レポート読み込み | 全レポート + 関連ファイル探索 |
| 2. コンテキスト構築 | 問題文 + 制約のみ | 問題文 + ステークホルダー + 制約 + 評価基準 | 全項目 + 外部情報補完 |
| 3. 代替案抽出 | 指定された案のみ | レポートから自動抽出（3案以上） | 自動抽出 + 業界標準補完 |
| 4. 比較表生成 | 定性比較のみ | 定量 + 定性比較 | 定量 + 定性 + SWOT + スコアリング |
| 5. 決定文書化 | 決定 + 根拠のみ | 決定 + 根拠 + 棄却理由 + トレードオフ | 全項目 + 詳細思考プロセス |
| 6. 影響分析 | P/N影響のみ | P/N/U影響 + 4軸分析（簡易） | P/N/U影響 + 4軸分析（詳細） + リスクマトリクス |
| 7. 最終組立 | 基本構造 + チェック | 全構造 + チェック + メタデータ | 全構造 + 全チェック + 詳細メタデータ |

## Output Format

### ADRドキュメント構造テンプレート

```markdown
---
adr_id: ADR-{NNN}
title: "{ADRタイトル}"
status: proposed
date: {YYYY-MM-DD}
decision_makers:
  - {意思決定者}
related_adrs: []
tags:
  - {タグ}
source_reports:
  - {レポートID}
project: {プロジェクト名}
---

# ADR-{NNN}: {ADRタイトル}

> **Status**: {proposed | accepted | deprecated | superseded}
> **Date**: {YYYY-MM-DD}
> **Decision Makers**: {意思決定者のリスト}
> **Supersedes**: {旧ADR番号（該当する場合）}
> **Superseded by**: {新ADR番号（該当する場合）}

---

## 目次

1. [Context（背景・文脈）](#context背景文脈)
2. [Alternatives Considered（検討した代替案）](#alternatives-considered検討した代替案)
3. [Comparison（比較分析）](#comparison比較分析)
4. [Decision（決定）](#decision決定)
5. [Consequences（影響・結果）](#consequences影響結果)
6. [References（参照情報）](#references参照情報)

---

## Context（背景・文脈）

### 問題の背景

{意思決定が必要になった背景の説明。
数値的根拠を含めること。}

### 制約条件

| # | 制約種別 | 制約内容 |
|---|---------|---------|
| 1 | {種別} | {内容} |

### ステークホルダー

| ステークホルダー | 関心事 | 影響度 |
|---------------|--------|--------|
| {名称} | {関心事} | 高/中/低 |

### 評価基準

| # | 評価基準 | 重み | 測定方法 |
|---|---------|------|---------|
| 1 | {基準名} | {1-5} | {方法} |

---

## Alternatives Considered（検討した代替案）

### 代替案A: {名称}

**概要**: {説明}

**メリット**:
- {メリット1}（{出典}）
- {メリット2}（{出典}）

**デメリット**:
- {デメリット1}（{出典}）
- {デメリット2}（{出典}）

### 代替案B: {名称}

{同様の構造}

### 代替案C: {名称}

{同様の構造}

### 除外した選択肢

| 選択肢 | 除外理由 |
|--------|---------|
| {名称} | {理由} |

---

## Comparison（比較分析）

### 定量比較

| 評価指標 | 代替案A | 代替案B | 代替案C | 出典 |
|---------|--------|--------|--------|------|
| {指標} | {値} | {値} | {値} | {ID} |

### 定性比較

| 観点 | 代替案A | 代替案B | 代替案C |
|------|--------|--------|--------|
| {観点} | {評価} | {評価} | {評価} |

### 重み付きスコアリング（include_scoring=true の場合）

| 評価基準 | 重み | 案Aスコア | 案Bスコア | 案Cスコア |
|---------|------|----------|----------|----------|
| {基準} | {W} | {S}/5 | {S}/5 | {S}/5 |
| **加重合計** | — | **{合計}** | **{合計}** | **{合計}** |

---

## Decision（決定）

**{代替案X}: {名称}を採用する。**

### 決定の根拠

1. **{根拠カテゴリ1}**: {説明}
   - エビデンス: {数値}（出典: {ID}）

2. **{根拠カテゴリ2}**: {説明}
   - エビデンス: {数値}（出典: {ID}）

3. **{根拠カテゴリ3}**: {説明}
   - エビデンス: {数値}（出典: {ID}）

### 不採用とした代替案

#### {代替案Y}
**棄却理由**: {理由}

#### {代替案Z}
**棄却理由**: {理由}

### トレードオフ

| 得られるもの | 失うもの/受け入れるリスク |
|------------|----------------------|
| {メリット} | {デメリット/リスク} |

---

## Consequences（影響・結果）

### ポジティブな影響

| # | 影響領域 | 影響内容 | 影響度 |
|---|---------|---------|--------|
| P1 | {領域} | {内容} | 高/中/低 |

### ネガティブな影響

| # | 影響領域 | 影響内容 | 影響度 | 軽減策 |
|---|---------|---------|--------|--------|
| N1 | {領域} | {内容} | 高/中/低 | {軽減策} |

### ニュートラルな影響

| # | 影響領域 | 影響内容 |
|---|---------|---------|
| U1 | {領域} | {内容} |

### 4軸影響分析

#### スコープ影響
{スコープ影響の記述}

#### リスク影響
{リスク影響の記述}

#### コスト影響
{コスト影響の記述}

#### タイムライン影響
{タイムライン影響の記述}

### 影響サマリ

| 分析軸 | 評価 | 主な理由 |
|--------|------|---------|
| スコープ | {大/中/小} | {理由} |
| リスク | {高/中/低} | {理由} |
| コスト | {高/中/低} | {理由} |
| タイムライン | {長/中/短} | {理由} |

---

## References（参照情報）

### 入力分析レポート

| レポートID | タイトル | 種別 | 引用箇所数 |
|-----------|---------|------|-----------|
| {ID} | {タイトル} | {種別} | {N}箇所 |

### 関連ADR

| ADR ID | タイトル | 関係性 |
|--------|---------|--------|
| {ID} | {タイトル} | {関係} |

### 外部参照

| # | タイトル | URL |
|---|---------|-----|
| 1 | {タイトル} | {URL} |

### 用語定義

| 用語 | 定義 |
|------|------|
| {用語} | {定義} |

---

*本ADRは adr-creator スキル (S-015) により生成されました。*
*生成日: {YYYY-MM-DD}*

<!-- Quality Check: {PASSED/FAILED} ({N}/{Total} items) -->
<!-- Generated by: adr-creator skill (S-015) -->
<!-- Check Date: {YYYY-MM-DD} -->
```

## Examples

### Example 1: RAG-Enhanced MCPアーキテクチャ選定ADR（standard — 実績ベース）

```
入力:
  decision_context: |
    Nablarch開発支援のためのAIアシスタント構築において、
    最適なアーキテクチャパターンを決定する必要がある。
  report_files:
    - "output/O-001_community_research.md"
    - "output/O-002_fintan_analysis.md"
    - "output/O-005_knowledge_base.md"
    - "output/O-006_tech_comparison.md"
    - "output/O-022_rag_plan.md"
    - "output/O-023_mcp_design.md"
  output_dir: "output/adr"
  adr_title: "RAG-Enhanced MCPサーバーアーキテクチャの採用"
  depth: "standard"
  include_scoring: true
  tags: ["RAG", "MCP", "Nablarch", "アーキテクチャ"]

Phase 1 — 入力分析:
  6本のレポートから以下のエビデンスを自動抽出:
  - GitHub Stars: 42（Nablarch） vs 76,000（Spring Boot）
  - Qiita記事: 14件
  - 公開リポジトリ: 114（nablarchオーガニゼーション）
  - CVE: 2件（CVE-2019-5918, CVE-2019-5919）
  - Fintan学習コンテンツ: 開発標準一式
  - RAGシステムの月額コスト試算: 5,000〜15,000円
  - MCPプロトコル対応状況: Claude Code標準サポート

Phase 2 — コンテキスト構築:
  問題文:
  「Nablarchは独自のアーキテクチャを持ちコミュニティ規模が限定的であるため、
  汎用LLMだけでは不十分。専門知識ベースの構築方法を決定する必要がある。」
  ステークホルダー: 開発チーム、アーキテクト、プロジェクトリード
  制約: OSS利用可、月額コスト上限あり、Claude Code統合が必須
  評価基準: 9項目（技術適合性、コスト効率、拡張性等）

Phase 3 — 代替案抽出:
  3パターンを特定:
  A. 静的ドキュメントサーバー方式
  B. RAG-Enhanced MCPサーバー方式
  C. Fine-tuned専用モデル方式

Phase 4 — 比較表生成:
  9観点の定量+定性比較表を生成:
  - 開発コスト、回答精度、保守性、拡張性、運用コスト、
    導入速度、リアルタイム性、Claude Code統合、コスト効率
  重み付きスコアリング:
  - パターンA: 合計48/135
  - パターンB: 合計112/135（最高）
  - パターンC: 合計76/135

Phase 5 — 決定文書化:
  「パターンB: RAG-Enhanced MCPサーバー方式を採用する」
  根拠:
  1. 技術適合性: MCPプロトコルによるClaude Codeとの自然な統合
  2. コスト効率: Fine-tuning方式の1/10以下のコスト
  3. 拡張性: ドキュメント追加がベクトルDB更新のみで完了
  4. コミュニティ対応: 限定的なコミュニティ（Stars: 42）を補完する設計

Phase 6 — 影響分析:
  ポジティブ: 4項目（高精度回答、低コスト、拡張容易性、IDE統合）
  ネガティブ: 3項目（ベクトルDB運用、Embeddingモデル選定、初期構築工数）
  ニュートラル: 2項目（既存フロー影響なし、チーム体制変更なし）
  4軸分析: スコープ=中、リスク=中、コスト=低、タイムライン=中

Phase 7 — 最終組立:
  ADR-001として採番
  品質チェック: 15/15項目PASSED
  出力: output/adr/ADR-001-rag-enhanced-mcp-architecture.md（約194行）
```

### Example 2: データベース選定ADR（quick）

```
入力:
  decision_context: |
    新規マイクロサービスのデータストアとして、
    RDB（PostgreSQL）またはNoSQL（MongoDB）のいずれかを選定する。
  report_files:
    - "output/db_comparison_report.md"
  output_dir: "output/adr"
  depth: "quick"
  alternatives:
    - name: "PostgreSQL"
      description: "リレーショナルデータベース。ACID準拠、JSON対応"
    - name: "MongoDB"
      description: "ドキュメント指向NoSQL。スキーマレス、水平スケーリング"
  tags: ["データベース", "マイクロサービス"]

Phase 1 — 入力分析:
  1本のレポートから主要数値を抽出:
  - PostgreSQL: GitHub Stars 16k, DB-Engines Ranking #4
  - MongoDB: GitHub Stars 27k, DB-Engines Ranking #5
  - ベンチマーク: 読み取り性能、書き込み性能の比較値

Phase 2 — コンテキスト構築:
  問題文と制約のみ（quickモード）
  ステークホルダー分析は省略

Phase 3 — 代替案抽出:
  指定された2案をそのまま使用
  除外案の記載なし

Phase 4 — 比較表生成:
  定性比較のみ（quickモード）
  スコアリングは省略

Phase 5 — 決定文書化:
  決定 + 主要根拠3つのみ

Phase 6 — 影響分析:
  P/N影響のみ（4軸分析は省略）

Phase 7 — 最終組立:
  ADR-002として採番
  品質チェック: 10/15項目（quick向け簡易チェック）
  出力: output/adr/ADR-002-database-selection.md（約80行）
```

### Example 3: 認証基盤移行ADR（thorough + supersede）

```
入力:
  decision_context: |
    現行の自社認証基盤（ADR-005で決定）を、
    Auth0ベースのIDaaS基盤に移行するかどうかを決定する。
    セキュリティ監査の指摘事項への対応と、
    マルチテナント対応の必要性が背景にある。
  report_files:
    - "output/auth_security_audit.md"
    - "output/idaas_comparison.md"
    - "output/migration_cost_analysis.md"
    - "output/auth0_poc_results.md"
  output_dir: "output/adr"
  depth: "thorough"
  status_action: "supersede"
  supersedes_adr: "ADR-005"
  include_swot: true
  include_scoring: true
  decision_makers:
    - "セキュリティチームリード"
    - "CTО"
  stakeholders:
    - name: "セキュリティチーム"
      interest: "脆弱性対応、コンプライアンス"
    - name: "開発チーム"
      interest: "認証API変更の影響、学習コスト"
    - name: "運用チーム"
      interest: "運用負荷、SLA"
    - name: "経営層"
      interest: "コスト、セキュリティリスク"
  evaluation_criteria:
    - name: "セキュリティ"
      weight: 5
    - name: "コンプライアンス対応"
      weight: 5
    - name: "移行コスト"
      weight: 4
    - name: "運用コスト"
      weight: 3
    - name: "開発者体験"
      weight: 3
  tags: ["認証", "セキュリティ", "IDaaS", "マイグレーション"]

Phase 1 — 入力分析:
  4本のレポートから詳細なエビデンスを抽出:
  - セキュリティ監査: 指摘事項12件（重大3件、中程度5件、軽微4件）
  - IDaaS比較: Auth0, Okta, Azure AD B2C, Firebase Auth の4製品比較
  - 移行コスト: 初期費用500万円、月額運用費15万円（Auth0 Essentialプラン）
  - PoC結果: レスポンスタイム中央値45ms、認証成功率99.97%

Phase 2 — コンテキスト構築:
  全項目を詳細に記述
  外部情報（Auth0公式ドキュメント、OWASP等）も補完

Phase 3 — 代替案抽出:
  4案を検討:
  A. 現行自社基盤の改修
  B. Auth0への移行
  C. Oktaへの移行
  D. Azure AD B2Cへの移行
  除外案: Firebase Auth（エンタープライズ要件不適合）

Phase 4 — 比較表生成:
  定量+定性比較 + SWOT分析（上位2案）+ 重み付きスコアリング
  5評価基準 × 4案の詳細比較表

Phase 5 — 決定文書化:
  「Auth0への移行を採用する」
  根拠5つ + 棄却理由3案分 + 詳細トレードオフ分析

Phase 6 — 影響分析:
  P/N/U影響 + 4軸詳細分析 + リスクマトリクス
  移行スケジュール: 3フェーズ、合計16週

Phase 7 — 最終組立:
  ADR-012として採番
  旧ADR-005のステータスを「superseded by ADR-012」に更新
  品質チェック: 15/15項目PASSED
  出力: output/adr/ADR-012-auth-platform-migration.md（約350行）
  更新: output/adr/ADR-005-*.md のステータス変更
```

## Guidelines

### 必須ルール

1. **数値的エビデンスの必須引用**
   - ADR内で最低3箇所以上の数値的エビデンスを引用すること
   - 全てのエビデンスに出典（レポートID + セクション）を付記すること
   - エビデンスのない主張は「エビデンス未確認」と明記すること
   - 古いデータ（1年以上前）には「{YYYY年}時点のデータ」と注記すること

2. **代替案の公平な比較**
   - 採用案のメリットだけでなく、デメリットも必ず記載すること
   - 不採用案のメリットも記載すること（なぜそのメリットを諦めたかを説明）
   - 比較は同じ観点で対称的に行うこと（一方だけに言及する観点を作らない）
   - 「どの案にも一長一短がある」が通常の状態であり、一方的な評価は疑うべき

3. **推測と事実の分離**
   - 分析レポートに記載されたデータは「事実」として引用
   - レポートにないが推定したデータは「推定」「想定」と明記
   - 「一般的に」「通常」等の表現は具体的な根拠があるか確認
   - 確信度が低い記述には「要検証」タグを付与

4. **ADR番号の一意性の保証**
   - 既存ADRのスキャンを必ず実施し、番号の重複を防ぐ
   - 手動で番号を指定された場合も重複チェックを行う
   - 重複が検出された場合は警告を出し、次の番号を提案する

5. **ステータスの正確な管理**
   - 新規ADRの初期ステータスは必ず「proposed」
   - ステータス変更は明示的な指示があった場合のみ実行
   - supersede/deprecate 操作時は旧ADRの更新を忘れないこと
   - ステータス履歴をメタデータに記録すること

6. **レポートへの忠実性**
   - 分析レポートの内容を歪曲しないこと
   - 引用は正確に行い、文脈を切り取って意味を変えないこと
   - レポート間で矛盾がある場合は両方を記載し、矛盾を明示すること

7. **品質チェックの完全実施**
   - Phase 7.5の品質チェックリストを全項目確認すること
   - 1項目でもFAILの場合は修正してから出力すること
   - チェック結果をADR末尾に記録すること

8. **出力先ディレクトリの事前確認**
   - output_dir が存在しない場合は自動作成する
   - 同名ファイルが存在する場合は警告を出し、上書き確認を求める

### 効率化のコツ

1. **並列読み込みの活用**
   - Phase 1で複数のレポートファイルを並列で Read する
   - 独立した分析（数値抽出、定性データ抽出）も並列実行

2. **テンプレートの活用**
   - 各Phase のテンプレートを活用し、漏れなく情報を整理する
   - テンプレートの項目が不要な場合は「該当なし」と記載（削除しない）

3. **既存ADRの参照**
   - 同一プロジェクトの既存ADRを参照し、一貫したフォーマット・用語を使用
   - 既存ADRで使用されている評価基準を再利用（比較可能性の確保）

4. **エビデンス管理表の作成**
   - Phase 1の段階で「エビデンス管理表」を内部的に作成
   - 出典・数値・文脈を一元管理し、Phase 5での引用を効率化

5. **段階的な品質向上**
   - まず全セクションのドラフトを作成し、次に品質チェックで改善
   - 完璧を目指して1セクションに時間をかけすぎない

6. **depth に応じた省略判断**
   - quick: 最小限の構造で迅速に出力。SWOT、スコアリング、4軸分析は省略
   - standard: 標準的な構造。主要な分析は全て実施
   - thorough: 全ての分析を詳細に実施。外部情報の補完も行う

### アンチパターン（避けるべきこと）

1. **エビデンスなき主張**
   - 「○○が最適である」と断言するが、数値的根拠を示さない
   - 対策: 主張には必ず「なぜなら{数値データ}であるため」を付記

2. **一方的な評価**
   - 採用案のメリットのみ強調し、デメリットを軽視する
   - 不採用案のデメリットのみ強調し、メリットに触れない
   - 対策: 各案のメリット/デメリットを同じ観点で対称的に記述

3. **曖昧な棄却理由**
   - 「総合的に判断して不採用とした」のような根拠のない棄却
   - 対策: 棄却理由は具体的なデータポイントとともに記述

4. **トレードオフの隠蔽**
   - 全てにおいて採用案が優れているかのように記述する
   - 対策: 「この決定により{X}を得る代わりに{Y}を受け入れる」を明記

5. **過度な楽観**
   - ネガティブ影響やリスクを過小評価する
   - 対策: ネガティブ影響は最低2項目を記載。ゼロは不自然と認識する

6. **出典の欠落**
   - 数値を引用しながら出典レポートIDを記載しない
   - 対策: 全ての数値引用に「（{レポートID}より）」を付記

7. **ステータスの不整合**
   - supersede操作で旧ADRの更新を忘れる
   - 新規ADRのステータスを最初から「accepted」にする
   - 対策: ステータスの遷移ルールを厳守。新規は必ず「proposed」から開始

8. **番号の重複**
   - 既存ADRを確認せずに番号を採番し、重複が発生する
   - 対策: Phase 7.1の自動採番手順を必ず実行

9. **巨大な単一セクション**
   - Context セクションにあらゆる情報を詰め込み、他のセクションが薄くなる
   - 対策: 各セクションのバランスを意識。Context は背景に特化し、比較はComparison、影響はConsequencesに分離

10. **レポート間の矛盾の無視**
    - 複数のレポートで異なるデータが記載されているのに、一方だけを採用する
    - 対策: 矛盾がある場合は両方のデータを記載し、「{レポートA}では{X}、{レポートB}では{Y}と報告されている」と明記

11. **テンプレートの機械的な埋め込み**
    - テンプレートの全フィールドを無理に埋めようとし、不自然な記述が生まれる
    - 対策: 該当しない項目は「該当なし」と記載し、無理に埋めない

12. **日付情報の欠落**
    - エビデンスの鮮度（いつのデータか）を記載しない
    - 対策: 「{YYYY年MM月}時点」または「{レポートID}（{作成日}）より」と記載
