---
name: nablarch-doc-generator
description: 既存の分析レポート群（O-XXX形式Markdown）を入力とし、プロジェクトの設計ドキュメントセットを体系的に生成するスキル。「分析レポートから設計ドキュメントを作成して」「O-001〜O-023のレポートをもとにarchitecture.mdとuse-cases.mdを生成して」「調査結果を設計書にまとめて」「既存のナレッジベースからプロジェクト概要書を作って」といった要望に対応する。レポート棚卸し・情報抽出・構造設計・ドキュメント生成・相互整合性チェック・品質保証の6フェーズで、architecture.md / use-cases.md / overview.md / user-guide.md 等の設計ドキュメントセットを一括生成する。Mermaid図自動生成・用語集・相互参照検証を含む包括的ドキュメント生成スキル。
---

# Nablarch Doc Generator — 分析レポートからの設計ドキュメント体系的生成

## Overview

既存の分析レポート群（O-XXX形式のMarkdownファイル）を入力として、プロジェクトの**設計ドキュメントセット**を体系的に生成するスキル。複数の調査・分析レポートに散在する情報を統合・再構成し、一貫性のある設計ドキュメント群として出力する。

**実績**: cmd_017において、ashigaru7が6つの分析レポート（O-001, O-002, O-005, O-006, O-022, O-023）を入力とし、4つの設計ドキュメント（architecture.md, use-cases.md, overview.md, user-guide.md）を生成。合計3228行の包括的ドキュメントセットを完成させた。

**主な用途:**
- 調査・分析フェーズの成果物を設計ドキュメントに変換
- プロジェクトの全体像を俯瞰できるドキュメントセットの構築
- ステークホルダー向けの技術資料の一括生成
- ナレッジベース（KB）から利用者向けドキュメントへの変換
- MCPサーバーやRAGシステム等の技術プロジェクトの設計書作成
- 新規参画メンバー向けのオンボーディング資料の生成

**このスキルの特徴:**
- 6フェーズのシステマティックなドキュメント生成プロセス
- 入力レポートの自動棚卸しと情報分類
- Mermaidダイアグラムの自動生成（アーキテクチャ図、シーケンス図、コンポーネント図、デプロイメント図）
- ドキュメント間の相互参照と用語統一の自動検証
- メタデータ管理（バージョン、作成日、関連ドキュメント、親タスク）
- 品質チェックリストによる最終検証

## When to Use

以下のいずれかに該当する場合にこのスキルを使用する：

- 「分析レポートから設計ドキュメントを作成して」
- 「O-001〜O-023のレポートをもとにドキュメントセットを生成して」
- 「調査結果を設計書にまとめて」
- 「既存のナレッジベースからプロジェクト概要書を作って」
- 「architecture.md と use-cases.md を生成して」
- 「複数レポートの内容を統合してドキュメント化して」
- 「プロジェクトの技術ドキュメントを一式作成して」
- 「ステークホルダー向けの技術概要資料を作成して」
- 「新規メンバー向けのオンボーディングドキュメントを生成して」
- 複数の分析レポートから一貫性のある設計ドキュメントセットを生成する必要がある場合
- 既存の調査成果を利用者向けのドキュメントに変換したい場合

**トリガーキーワード**: ドキュメント生成, 設計書作成, レポート統合, ドキュメントセット, architecture.md, use-cases.md, overview.md, user-guide.md, 設計ドキュメント, 技術資料作成

## Instructions

### Phase 1: レポート棚卸しと分析（Report Inventory & Analysis）

入力として指定された全分析レポートを読み込み、各レポートの内容・範囲・品質を把握する。

#### Step 1.1: 入力レポートの一覧化

```
【実行手順】

1. 指定されたディレクトリまたはファイルリストから全入力レポートを特定
   - ファイル名パターン: O-XXX_*.md（例: O-001_nablarch_mcp_server_plan.md）
   - 指定されたファイルが全て存在するか確認

2. 各レポートの基本情報を抽出
   - ファイル名
   - タスクID（ヘッダから抽出）
   - 作成日
   - 作成者
   - 行数（wc -l で取得）
   - 主要セクション一覧（## レベルの見出しを列挙）

3. レポート棚卸しテーブルを作成

   | # | ファイル名 | タスクID | 作成日 | 行数 | 主要トピック |
   |---|----------|---------|--------|------|------------|
   | 1 | O-001_nablarch_mcp_server_plan.md | subtask_001 | 2026-01-31 | 450 | MCP構築計画 |
   | 2 | O-002_nablarch_rag_system_plan.md | subtask_002 | 2026-01-31 | 380 | RAGシステム計画 |
   | ... | ... | ... | ... | ... | ... |
```

#### Step 1.2: レポート内容の概要分析

```
【実行手順】

1. 各レポートを通読し、以下の情報を記録
   - レポートの目的・スコープ
   - 含まれる技術的な判断・決定事項
   - アーキテクチャに関する記述
   - ユースケースに関する記述
   - 制約事項・前提条件
   - 推奨事項・結論

2. レポート間の関連性を分析
   - 重複している情報（複数レポートに記載）
   - 矛盾している情報（レポート間で齟齬）
   - 補完関係にある情報（A が概要、B が詳細）
   - 時系列的な更新関係（A の結論が B で変更）

3. 情報の鮮度を評価
   - 最新の判断・決定が反映されているレポートを特定
   - 古い情報が新しい決定で上書きされている箇所を記録
   - 「殿の方針決定」等の最終判断を最優先とする
```

#### Step 1.3: 情報カバレッジの評価

```
【評価マトリクス】

出力ドキュメント別に、各入力レポートがどの程度カバーしているかを評価する。

               | architecture.md | use-cases.md | overview.md | user-guide.md |
O-001          |       ◎        |      ○       |     ◎      |      △       |
O-002          |       ○        |      ○       |     ○      |      △       |
O-005          |       ◎        |      △       |     ○      |      ◎       |
O-006          |       ◎        |      △       |     ○      |      ○       |
O-022          |       ◎        |      ◎       |     ○      |      △       |
O-023          |       ○        |      ◎       |     ○      |      △       |

凡例: ◎=主要情報源 ○=補助的情報あり △=間接的情報のみ ×=関連なし

【カバレッジギャップの特定】
- 情報が不足しているドキュメント領域を特定
- 追加調査が必要かどうかを判断
- 不足情報は「【要追加調査】」タグを付けてドキュメントに記載
```

### Phase 2: 情報抽出と再構成（Information Extraction & Restructuring）

各レポートから出力ドキュメントに必要な情報を抽出し、カテゴリ別に再構成する。

#### Step 2.1: 技術的決定事項の抽出

```
【抽出対象】

1. アーキテクチャ決定（Architecture Decisions）
   - 採用技術・フレームワーク
   - 設計パターン
   - 通信プロトコル・トランスポート
   - データベース・永続化方式
   - セキュリティ方式
   - 決定の根拠（理由・比較検討結果）

2. 技術スタック
   - 言語・ランタイム（バージョン含む）
   - フレームワーク・ライブラリ
   - 外部サービス・API
   - ビルドツール・CI/CD

3. 制約事項
   - 技術的制約
   - ビジネス的制約
   - ライセンス制約
   - パフォーマンス要件

4. 殿（上様）の方針決定
   - 最終判断事項（最優先で反映）
   - 却下された選択肢
   - 保留事項
```

#### Step 2.2: アーキテクチャパターンの抽出

```
【抽出手順】

1. システム全体のアーキテクチャ
   - レイヤー構成
   - コンポーネント構成
   - 外部連携先
   - データフロー

2. コンポーネント間の関係
   - 依存関係
   - 通信方式（同期/非同期）
   - データ共有方式

3. デプロイメント構成
   - 実行環境
   - コンテナ化方式
   - スケーリング方式

4. Mermaidダイアグラム用の情報整理
   - ノード（コンポーネント）の列挙
   - エッジ（関係）の列挙
   - グルーピング（サブシステム）の特定
```

#### Step 2.3: ユースケースの抽出

```
【抽出手順】

1. アクター（利用者）の特定
   - プライマリアクター（直接的な利用者）
   - セカンダリアクター（間接的な利用者・外部システム）
   - 各アクターの目的・動機

2. ユースケースの列挙
   - 各アクターが実行する操作
   - 前提条件（Pre-condition）
   - 事後条件（Post-condition）
   - 基本フロー（Main Flow）
   - 代替フロー（Alternative Flow）
   - 例外フロー（Exception Flow）

3. ユースケース間の関係
   - include 関係
   - extend 関係
   - 依存関係

4. 非機能要件
   - パフォーマンス要件
   - セキュリティ要件
   - 可用性要件
   - 拡張性要件
```

#### Step 2.4: 要件と推奨事項の抽出

```
【抽出手順】

1. 機能要件
   - 必須機能（Must）
   - 推奨機能（Should）
   - 追加機能（Could）
   - 除外機能（Won't）

2. 非機能要件
   - パフォーマンス
   - セキュリティ
   - 可用性・信頼性
   - 保守性
   - 移植性

3. ロードマップ情報
   - フェーズ分割
   - 各フェーズの目標と成果物
   - マイルストーン
   - 完了基準

4. リスクと対策
   - 技術リスク
   - ビジネスリスク
   - セキュリティリスク
   - 各リスクの対策
```

### Phase 3: ドキュメント構造設計（Document Structure Design）

生成するドキュメントの種類、セクション構成、相互参照関係を設計する。

#### Step 3.1: 生成ドキュメントの決定

```
【標準ドキュメントセット】

以下の4ドキュメントを標準セットとする。プロジェクトの特性に応じて追加・変更可能。

1. architecture.md（アーキテクチャ設計書）
   - 対象読者: 開発者、テックリード、アーキテクト
   - 目的: システムの技術的な全体像と設計判断を記録
   - 推奨行数: 800〜1200行

2. use-cases.md（ユースケース仕様書）
   - 対象読者: 開発者、プロダクトオーナー、QAエンジニア
   - 目的: システムの機能的な要件と利用シナリオを記録
   - 推奨行数: 400〜700行

3. overview.md（プロジェクト概要書）
   - 対象読者: 全ステークホルダー（技術・非技術）
   - 目的: プロジェクトの目的・背景・概要を簡潔に記録
   - 推奨行数: 300〜500行

4. user-guide.md（利用者ガイド）
   - 対象読者: エンドユーザー、運用担当者
   - 目的: システムの導入・設定・利用方法をステップバイステップで記録
   - 推奨行数: 500〜800行

【追加ドキュメント（必要に応じて）】

5. api-reference.md（APIリファレンス）
   - ツール/リソース/プロンプトの仕様詳細

6. glossary.md（用語集）
   - プロジェクト固有の用語定義

7. adr/（Architecture Decision Records）
   - 個別のアーキテクチャ決定記録

8. deployment-guide.md（デプロイメントガイド）
   - 環境構築・デプロイ手順
```

#### Step 3.2: セクション構成の設計

```
【architecture.md のセクション構成】

# {プロジェクト名} アーキテクチャ設計書

## メタデータ（ヘッダ）
## 目次
## 1. エグゼクティブサマリ
## 2. システム概要
   ### 2.1 目的と背景
   ### 2.2 スコープ
   ### 2.3 前提条件と制約
## 3. アーキテクチャ概要
   ### 3.1 アーキテクチャ原則
   ### 3.2 全体構成図
   ### 3.3 技術スタック
## 4. コンポーネント設計
   ### 4.1 コンポーネント一覧
   ### 4.2 各コンポーネントの詳細
   ### 4.3 コンポーネント間の関係
## 5. データ設計
   ### 5.1 データモデル
   ### 5.2 データフロー
## 6. インフラストラクチャ
   ### 6.1 デプロイメント構成
   ### 6.2 スケーリング方針
## 7. セキュリティ設計
## 8. 横断的関心事
   ### 8.1 ロギング
   ### 8.2 エラーハンドリング
   ### 8.3 パフォーマンス
## 9. 技術的決定事項（ADR要約）
## 10. ロードマップ
## 11. 参考資料

---

【use-cases.md のセクション構成】

# {プロジェクト名} ユースケース仕様書

## メタデータ（ヘッダ）
## 目次
## 1. アクター定義
   ### 1.1 プライマリアクター
   ### 1.2 セカンダリアクター
## 2. ユースケース概要
   ### 2.1 ユースケース一覧
   ### 2.2 ユースケース図
## 3. ユースケース詳細
   ### 3.X {ユースケース名}
      #### 概要
      #### アクター
      #### 前提条件
      #### 基本フロー
      #### 代替フロー
      #### 例外フロー
      #### 事後条件
## 4. 非機能要件
## 5. 制約事項
## 6. 参考資料

---

【overview.md のセクション構成】

# {プロジェクト名} — プロジェクト概要

## メタデータ（ヘッダ）
## 目次
## 1. プロジェクトの目的
## 2. 背景と課題
## 3. ソリューション概要
## 4. 主要機能
## 5. 技術的ハイライト
## 6. ターゲットユーザー
## 7. プロジェクト構成
## 8. 現在のステータス
## 9. 関連ドキュメント
## 10. 用語集

---

【user-guide.md のセクション構成】

# {プロジェクト名} — 利用者ガイド

## メタデータ（ヘッダ）
## 目次
## 1. はじめに
   ### 1.1 このドキュメントについて
   ### 1.2 対象読者
   ### 1.3 前提知識
## 2. クイックスタート
   ### 2.1 前提条件
   ### 2.2 インストール
   ### 2.3 初回セットアップ
   ### 2.4 動作確認
## 3. 基本的な使い方
   ### 3.X {機能別の使い方}
## 4. 設定リファレンス
   ### 4.1 設定ファイル一覧
   ### 4.2 設定パラメータ詳細
## 5. トラブルシューティング
   ### 5.1 よくある問題と解決方法
   ### 5.2 エラーメッセージ一覧
## 6. FAQ
## 7. 参考資料
```

#### Step 3.3: 相互参照マップの設計

```
【ドキュメント間の相互参照ルール】

1. 各ドキュメントの「関連ドキュメント」セクションで他ドキュメントを参照
2. 本文中の技術用語は初出時にoverview.mdの用語集へリンク
3. アーキテクチャの詳細はarchitecture.mdへ「詳細は[architecture.md]参照」と記載
4. ユースケースの実現方式はarchitecture.mdの対応セクションを参照
5. 利用手順の背景説明はoverview.mdを参照

【参照マトリクス】

              → architecture | use-cases | overview | user-guide
architecture  |     --      |    ○     |    ○    |     ○
use-cases     |     ◎      |    --    |    ○    |     ○
overview      |     ○      |    ○     |    --   |     ○
user-guide    |     ○      |    △     |    ○    |     --

◎=頻繁に参照 ○=必要に応じて参照 △=稀に参照

【相互参照のフォーマット】
- 同一ディレクトリ内: [ドキュメント名](./filename.md#section-anchor)
- セクション指定: [セクション名](./filename.md#セクション名)
- 例: 詳細は[アーキテクチャ設計書 - コンポーネント設計](./architecture.md#4-コンポーネント設計)を参照。
```

### Phase 4: ドキュメント生成（Document Generation）

各ドキュメントを生成する。Mermaidダイアグラム、テーブル、コードブロックを適切に含める。

#### Step 4.1: architecture.md の生成

```
【生成手順】

1. メタデータヘッダの生成
   - プロジェクト名、バージョン、作成日、関連タスクID
   - 入力レポート一覧（ソーストレーサビリティ）

2. エグゼクティブサマリの作成
   - プロジェクトの技術的な結論を3〜5文で要約
   - 採用した主要技術の一覧テーブル

3. アーキテクチャ全体図の生成（Mermaid）
   - 主要コンポーネントとその関係を図示
   - 外部システムとの連携を含む

4. コンポーネント詳細の記述
   - 各コンポーネントの責務、技術スタック、インターフェース
   - コンポーネント間の依存関係図（Mermaid）

5. データフロー図の生成（Mermaid）
   - 主要なデータの流れをシーケンス図で表現

6. デプロイメント図の生成（Mermaid）
   - 実行環境、コンテナ構成

7. 技術的決定事項の記録
   - 各決定の背景、選択肢、選定理由
```

##### Mermaidダイアグラムパターン: アーキテクチャ図

```
【全体構成図パターン — C4 Model Level 1 相当】

graph TB
    subgraph "外部システム"
        User["利用者<br/>（開発者）"]
        AITool["AIコーディングツール<br/>（Claude Code等）"]
    end

    subgraph "対象システム"
        subgraph "プレゼンテーション層"
            API["APIエンドポイント"]
        end
        subgraph "アプリケーション層"
            Service["サービス<br/>コンポーネント"]
        end
        subgraph "インフラストラクチャ層"
            DB["データベース"]
            Cache["キャッシュ"]
        end
    end

    User --> AITool
    AITool --> API
    API --> Service
    Service --> DB
    Service --> Cache

【注意事項】
- ノード名には日本語を使用可能（Mermaid対応済み）
- サブグラフで論理的なグルーピングを表現
- 矢印の方向はデータフローまたは依存の方向
- 色分けは必須ではないが、レイヤー区別に有用
```

##### Mermaidダイアグラムパターン: シーケンス図

```
【リクエスト処理フローパターン】

sequenceDiagram
    participant User as 利用者
    participant Client as MCPクライアント
    participant Server as MCPサーバー
    participant KB as ナレッジベース

    User->>Client: 質問・指示
    Client->>Server: tools/call (JSON-RPC)
    Server->>KB: 情報検索
    KB-->>Server: 検索結果
    Server-->>Client: ツール実行結果
    Client-->>User: 回答・生成コード

【注意事項】
- 参加者（participant）は左から右へ呼び出し順に配置
- 同期呼び出しは ->> 、非同期は -->>
- 戻り値は点線矢印 -->>
- opt / alt / loop 等の制御構文を適切に使用
```

##### Mermaidダイアグラムパターン: コンポーネント図

```
【コンポーネント依存関係パターン】

graph LR
    subgraph "MCPサーバー"
        Tools["Tools<br/>コード生成・検証"]
        Resources["Resources<br/>API仕様・パターン"]
        Prompts["Prompts<br/>テンプレート"]
        Core["コアエンジン"]
    end

    subgraph "知識基盤"
        RAG["RAG検索エンジン"]
        Index["ベクトルインデックス"]
        Docs["ドキュメントDB"]
    end

    Tools --> Core
    Resources --> Core
    Prompts --> Core
    Core --> RAG
    RAG --> Index
    RAG --> Docs

【注意事項】
- コンポーネント名の下にサブタイトルで責務を記載
- 依存方向は上位→下位（利用する側→される側）
- 循環依存がある場合は設計上の問題として記録
```

##### Mermaidダイアグラムパターン: デプロイメント図

```
【デプロイメント構成パターン】

graph TB
    subgraph "開発者環境"
        IDE["IDE / CLI"]
        CC["Claude Code"]
    end

    subgraph "ローカル実行"
        STDIO["STDIO<br/>トランスポート"]
        LocalServer["MCPサーバー<br/>（ローカルプロセス）"]
    end

    subgraph "リモート実行"
        HTTP["Streamable HTTP<br/>トランスポート"]
        RemoteServer["MCPサーバー<br/>（コンテナ）"]
        Docker["Docker / K8s"]
    end

    CC --> STDIO
    STDIO --> LocalServer
    CC --> HTTP
    HTTP --> RemoteServer
    RemoteServer --> Docker

【注意事項】
- 物理的な配置（マシン/コンテナ/クラウド）をサブグラフで表現
- ネットワーク境界を明示
- トランスポート方式を矢印のラベルで表記
```

#### Step 4.2: use-cases.md の生成

```
【生成手順】

1. アクター定義
   - 入力レポートから利用者・外部システムを抽出
   - 各アクターの役割・目的を定義

2. ユースケース一覧テーブル
   | UC-ID | ユースケース名 | アクター | 優先度 | フェーズ |
   |-------|-------------|---------|--------|---------|

3. ユースケース図（Mermaid）
   - アクターとユースケースの関係を図示

4. 各ユースケースの詳細記述
   - 概要
   - アクター
   - 前提条件
   - 基本フロー（番号付きステップ）
   - 代替フロー
   - 例外フロー
   - 事後条件
   - 関連する技術的決定事項（architecture.mdへの参照）

5. 非機能要件の記述
   - パフォーマンス、セキュリティ、可用性等

【ユースケース詳細テンプレート】

### UC-{番号}: {ユースケース名}

| 項目 | 内容 |
|------|------|
| **ID** | UC-{番号} |
| **名称** | {ユースケース名} |
| **アクター** | {プライマリアクター} |
| **優先度** | 高 / 中 / 低 |
| **フェーズ** | Phase {N} |
| **関連ADR** | ADR-{番号} |

#### 概要
{1〜2文の概要}

#### 前提条件
- {前提条件1}
- {前提条件2}

#### 基本フロー
1. {ステップ1}
2. {ステップ2}
3. ...

#### 代替フロー
- **{条件}の場合**: {代替手順}

#### 例外フロー
- **{エラー条件}**: {エラー処理}

#### 事後条件
- {事後条件1}
```

##### Mermaidダイアグラムパターン: ユースケース図

```
【ユースケース図パターン（Mermaidのgraphで代用）】

graph LR
    Developer["開発者"]
    TechLead["テックリード"]
    AI["AIツール"]

    subgraph "ユースケース"
        UC1["UC-01: API検索"]
        UC2["UC-02: コード生成"]
        UC3["UC-03: 設定検証"]
        UC4["UC-04: パターン参照"]
        UC5["UC-05: 移行支援"]
    end

    Developer --> UC1
    Developer --> UC2
    Developer --> UC3
    TechLead --> UC4
    TechLead --> UC5
    AI --> UC1
    AI --> UC2
    AI --> UC3

【注意事項】
- MermaidにはUML標準のユースケース図がないため、graphで代用
- アクターは左側、ユースケースはサブグラフ内に配置
- 関係線は依存方向ではなく「利用する」方向
```

#### Step 4.3: overview.md の生成

```
【生成手順】

1. プロジェクト概要の作成
   - 技術者でない読者にも理解できる平易な言葉で記述
   - 専門用語は初出時に簡単な説明を付記
   - プロジェクトの「なぜ（Why）」を明確に

2. 背景と課題の記述
   - 現状の問題点
   - 解決すべき課題
   - 既存の代替手段とその限界

3. ソリューション概要
   - 提案するアプローチの概要
   - 期待される効果
   - 簡略化したアーキテクチャ図（Mermaid）

4. 主要機能一覧
   - 箇条書きまたはテーブルで簡潔に列挙
   - 各機能の1行説明

5. 技術的ハイライト
   - 特筆すべき技術的な特徴
   - 他プロジェクトとの差別化ポイント

6. プロジェクト構成
   - ディレクトリ構造
   - 関連リポジトリ
   - 関連ドキュメントへのリンク

7. 用語集の作成
   - プロジェクト固有の用語を定義
   - 略語の展開
   - 他ドキュメントから参照される共通用語

【用語集テンプレート】

| 用語 | 定義 | 備考 |
|------|------|------|
| MCP | Model Context Protocol。AIアプリケーションと外部システムを接続するオープン標準プロトコル | Anthropic発表 |
| RAG | Retrieval-Augmented Generation。外部知識を検索してLLMに注入する技術 | |
| FQCN | Fully Qualified Class Name。完全修飾クラス名 | Java固有 |
```

#### Step 4.4: user-guide.md の生成

```
【生成手順】

1. はじめに
   - ドキュメントの目的を明記
   - 対象読者と前提知識を明記
   - ドキュメントの構成を説明

2. クイックスタート
   - 最短で動作確認できる手順を記述
   - 前提条件のチェックリスト
   - コマンドはコピー&ペースト可能な形式で記載
   - 期待される出力結果を記載

3. 基本的な使い方
   - 機能別のステップバイステップ手順
   - スクリーンショットの代わりにコマンド例を豊富に記載
   - 各操作の「期待される結果」を必ず記載

4. 設定リファレンス
   - 全設定パラメータをテーブル形式で記載
   - デフォルト値、型、説明、例
   - 設定ファイルの全体例

5. トラブルシューティング
   - よくある問題と解決方法
   - エラーメッセージと対処法のテーブル
   - デバッグ方法

6. FAQ
   - 想定される質問と回答

【設定パラメータテーブルテンプレート】

| パラメータ | 型 | デフォルト | 必須 | 説明 |
|----------|-----|----------|------|------|
| `server.port` | int | 8080 | -- | サーバーのリスニングポート |
| `knowledge.base.path` | string | -- | yes | ナレッジベースのルートパス |

【エラーメッセージテーブルテンプレート】

| エラーコード | メッセージ | 原因 | 対処法 |
|------------|----------|------|--------|
| E001 | Connection refused | サーバー未起動 | サーバーを起動してください |
```

#### Step 4.5: メタデータヘッダの標準フォーマット

```
【全ドキュメント共通のメタデータヘッダ】

# {ドキュメントタイトル}

> **プロジェクト**: {プロジェクト名}
> **バージョン**: {ドキュメントバージョン（例: 1.0.0）}
> **作成日**: {YYYY-MM-DD}
> **最終更新日**: {YYYY-MM-DD}
> **タスクID**: {cmd_XXX}
> **作成者**: {エージェント名}
> **ステータス**: ドラフト / レビュー中 / 確定

### 入力ソース

本ドキュメントは以下の分析レポートを基に作成された。

| レポートID | タイトル | 作成日 |
|-----------|---------|--------|
| O-001 | {タイトル} | {日付} |
| O-002 | {タイトル} | {日付} |
| ... | ... | ... |

### 関連ドキュメント

| ドキュメント | 説明 |
|------------|------|
| [architecture.md](./architecture.md) | アーキテクチャ設計書 |
| [use-cases.md](./use-cases.md) | ユースケース仕様書 |
| [overview.md](./overview.md) | プロジェクト概要 |
| [user-guide.md](./user-guide.md) | 利用者ガイド |

---
```

### Phase 5: 相互整合性チェック（Cross-Document Consistency Check）

生成した全ドキュメント間の整合性を検証する。

#### Step 5.1: 相互参照の検証

```
【検証手順】

1. 内部リンクの検証
   - 全ドキュメント内のMarkdownリンクが有効か確認
   - アンカーリンク（#section-name）が実在するセクションを指しているか確認
   - 他ドキュメントへのリンク（./filename.md）が存在するファイルを指しているか確認

2. 参照の双方向性チェック
   - architecture.mdで言及されたユースケースがuse-cases.mdに存在するか
   - use-cases.mdで参照されたコンポーネントがarchitecture.mdに定義されているか
   - user-guide.mdで説明される機能がuse-cases.mdに定義されているか

3. 情報の一貫性チェック
   - 同じ技術用語が全ドキュメントで同じ意味で使われているか
   - バージョン番号や日付が全ドキュメントで一致しているか
   - 技術スタックの記述が全ドキュメントで一致しているか

【チェックリスト】
□ architecture.mdのコンポーネント名がuse-cases.mdと一致
□ overview.mdの機能一覧がuse-cases.mdのユースケースと対応
□ user-guide.mdの手順がarchitecture.mdの設計と整合
□ 全ドキュメントのメタデータ（バージョン、日付）が一致
□ 用語集の定義が全ドキュメントで統一的に使用されている
```

#### Step 5.2: 用語統一の検証

```
【用語統一ルール】

1. 用語の正規化
   - 表記ゆれのチェック（例: MCPサーバ / MCPサーバー → MCPサーバー に統一）
   - 英語/日本語表記の統一（例: ハンドラキュー / Handler Queue → ハンドラキュー に統一）
   - 略語と正式名称の使い分けルール確認

2. 用語集との整合性
   - overview.mdの用語集に定義された全用語が、他ドキュメントで正しく使われているか
   - 用語集に未定義だが頻出する専門用語がないか

3. 技術用語の正確性
   - FQCN（完全修飾クラス名）が正確か
   - バージョン番号が正確か
   - URL/リンクが正確か

【用語統一チェックリスト】
□ プロジェクト名の表記が全箇所で一致
□ 技術用語の日英表記が統一
□ 略語の初出に正式名称を併記
□ 同じ概念に異なる名称を使っていない
□ 用語集の全項目が本文で使用されている
```

#### Step 5.3: Mermaidダイアグラムの整合性検証

```
【検証手順】

1. コンポーネント名の一致
   - Mermaid図中のコンポーネント名が本文のテーブル/説明と一致するか
   - 省略や別名を使っていないか

2. 関係の正確性
   - 矢印の方向がデータフロー/依存関係を正しく表現しているか
   - 本文で説明された関係が図に反映されているか
   - 図にのみ存在し本文で説明されていない関係がないか

3. 図の構文検証
   - Mermaidの構文エラーがないか（レンダリング可能か）
   - 日本語が正しく表示されるか

4. ドキュメント間の図の整合性
   - architecture.mdの全体図とuse-cases.mdのユースケース図が矛盾しないか
   - overview.mdの簡略図がarchitecture.mdの詳細図の要約になっているか
```

### Phase 6: 品質保証（Quality Assurance）

最終的な品質チェックと調整を行う。

#### Step 6.1: 品質チェックリスト

```
【全ドキュメント共通チェック】

□ メタデータヘッダが完全（プロジェクト名、バージョン、日付、タスクID、入力ソース）
□ 目次が存在し、全セクションへのアンカーリンクが正しい
□ 各セクション冒頭に概要文がある
□ 500行以上のドキュメントには必ず目次がある
□ Mermaidダイアグラムが構文的に正しい
□ 相互参照リンクが全て有効
□ 用語が統一されている
□ 入力レポートの情報が正確に反映されている（改変なし）
□ 推測情報には「【推測】」プレフィックスが付いている
□ 情報のソース（入力レポートID）がトレース可能
□ 不足情報には「【要追加調査】」タグが付いている

---

【architecture.md 固有チェック】

□ アーキテクチャ全体図（Mermaid）が含まれている
□ コンポーネント一覧テーブルが含まれている
□ 全コンポーネントの責務が説明されている
□ コンポーネント間の依存関係が図示されている
□ 技術スタックテーブルが含まれている
□ データフロー図が含まれている
□ デプロイメント図が含まれている
□ 技術的決定事項の根拠が記載されている
□ セキュリティ設計セクションがある
□ ロードマップが含まれている

---

【use-cases.md 固有チェック】

□ アクター定義が完全
□ ユースケース一覧テーブルが含まれている
□ ユースケース図（Mermaid）が含まれている
□ 各ユースケースに基本フローが記載されている
□ 代替フローと例外フローが検討されている
□ 非機能要件セクションがある
□ 各ユースケースにアクターが明示されている
□ 優先度とフェーズが設定されている

---

【overview.md 固有チェック】

□ 技術者でない読者にも理解できる記述か
□ プロジェクトの「なぜ」が明確に記述されている
□ 主要機能が簡潔に列挙されている
□ 用語集が含まれている
□ 関連ドキュメントへのリンクが含まれている
□ プロジェクト構成（ディレクトリ構造）が記載されている

---

【user-guide.md 固有チェック】

□ 前提条件が明記されている
□ クイックスタートセクションがある
□ コマンド例がコピー&ペースト可能な形式
□ 各操作に「期待される結果」が記載されている
□ 設定パラメータテーブルが含まれている
□ トラブルシューティングセクションがある
□ FAQセクションがある
□ エラーメッセージ一覧がある
```

#### Step 6.2: 行数と網羅性の確認

```
【最終確認】

1. 各ドキュメントの行数が推奨範囲内か確認
   | ドキュメント | 推奨行数 | 実際の行数 | 判定 |
   |------------|---------|-----------|------|
   | architecture.md | 800〜1200 | {実測値} | OK / 要調整 |
   | use-cases.md | 400〜700 | {実測値} | OK / 要調整 |
   | overview.md | 300〜500 | {実測値} | OK / 要調整 |
   | user-guide.md | 500〜800 | {実測値} | OK / 要調整 |
   | **合計** | **2000〜3200** | {実測値} | |

2. 行数が不足している場合
   - 情報が不足しているセクションを特定
   - 入力レポートに追加抽出可能な情報がないか確認
   - 図表やコード例の追加で補完

3. 行数が過剰な場合
   - 冗長な記述を簡潔化
   - 詳細は別ドキュメント（appendix等）に分離
   - 重複記述の排除
```

#### Step 6.3: 最終調整と出力

```
【最終調整手順】

1. Markdownの書式統一
   - 見出しレベルの一貫性（# → ## → ### の階層を遵守）
   - リストのインデント統一（2スペースまたは4スペース）
   - コードブロックの言語指定（```yaml, ```xml, ```java, ```mermaid）
   - テーブルの列幅バランス調整

2. 読みやすさの向上
   - 長い段落の分割（1段落3〜5文を目安）
   - 箇条書きの活用
   - 強調表示（**太字**）の適切な使用
   - 情報の論理的な順序（概要→詳細→補足）

3. 出力
   - 各ドキュメントを指定のディレクトリに出力
   - ファイル名の確認（小文字、ハイフン区切り）
   - 出力結果のサマリテーブルを報告

【出力サマリテンプレート】

| # | ファイル | 行数 | セクション数 | Mermaid図数 | テーブル数 |
|---|---------|------|-----------|-----------|----------|
| 1 | architecture.md | {行数} | {数} | {数} | {数} |
| 2 | use-cases.md | {行数} | {数} | {数} | {数} |
| 3 | overview.md | {行数} | {数} | {数} | {数} |
| 4 | user-guide.md | {行数} | {数} | {数} | {数} |
| - | **合計** | **{合計}** | **{合計}** | **{合計}** | **{合計}** |
```

## Input Format

スキル実行時に以下のパラメータを指定する。

```yaml
# 必須パラメータ
project_name: "nablarch-mcp-server"               # プロジェクト名
input_reports:                                      # 入力レポートファイルのリスト
  - "output/O-001_nablarch_mcp_server_plan.md"
  - "output/O-002_nablarch_rag_system_plan.md"
  - "output/O-005_nablarch_kb_official_docs.md"
  - "output/O-006_nablarch_kb_architecture.md"
  - "output/O-022_nablarch_mcp_feasibility_study.md"
  - "output/O-023_nablarch_rag_mcp_analysis.md"
output_dir: "docs/"                                 # 出力ディレクトリ

# オプションパラメータ
documents:                                          # 生成するドキュメントのリスト（省略時は標準4種）
  - type: "architecture"
    filename: "architecture.md"
  - type: "use-cases"
    filename: "use-cases.md"
  - type: "overview"
    filename: "overview.md"
  - type: "user-guide"
    filename: "user-guide.md"

version: "1.0.0"                                    # ドキュメントバージョン
language: "ja"                                      # 出力言語（デフォルト: ja）
parent_task_id: "cmd_017"                           # 親タスクID
author: "ashigaru7"                                 # 作成者名

# ドキュメントカスタマイズ
include_glossary: true                              # 用語集を生成するか（デフォルト: true）
include_mermaid: true                               # Mermaidダイアグラムを含めるか（デフォルト: true）
include_cross_references: true                      # 相互参照を含めるか（デフォルト: true）
include_metadata_header: true                       # メタデータヘッダを含めるか（デフォルト: true）

# 品質設定
min_total_lines: 2000                               # 最小合計行数（デフォルト: 2000）
max_total_lines: 4000                               # 最大合計行数（デフォルト: 4000）
quality_level: "standard"                           # quick / standard / thorough（デフォルト: standard）

# 追加コンテキスト
project_context:                                    # プロジェクト追加コンテキスト（省略可）
  description: "Nablarchフレームワーク向けMCPサーバー"
  tech_stack:
    - "Java 17+"
    - "Spring Boot 3.3+"
    - "MCP Java SDK"
  target_users:
    - "Nablarch開発者"
    - "テックリード"
    - "AIツール利用者"
```

### パラメータ説明

| パラメータ | 必須 | デフォルト | 説明 |
|----------|------|----------|------|
| `project_name` | yes | -- | プロジェクト名。ドキュメントのタイトル等に使用 |
| `input_reports` | yes | -- | 入力レポートファイルのパスリスト |
| `output_dir` | yes | -- | 出力ディレクトリ |
| `documents` | -- | 標準4種 | 生成するドキュメントのリスト |
| `version` | -- | `1.0.0` | ドキュメントバージョン |
| `language` | -- | `ja` | 出力言語 |
| `parent_task_id` | -- | -- | 親タスクID（トレーサビリティ用） |
| `author` | -- | -- | 作成者名 |
| `include_glossary` | -- | `true` | 用語集を生成するか |
| `include_mermaid` | -- | `true` | Mermaidダイアグラムを含めるか |
| `include_cross_references` | -- | `true` | 相互参照を含めるか |
| `include_metadata_header` | -- | `true` | メタデータヘッダを含めるか |
| `min_total_lines` | -- | `2000` | 最小合計行数 |
| `max_total_lines` | -- | `4000` | 最大合計行数 |
| `quality_level` | -- | `standard` | 品質レベル |
| `project_context` | -- | -- | プロジェクト追加コンテキスト |

### ドキュメントタイプ一覧

| type | 説明 | 推奨行数 | 対象読者 |
|------|------|---------|---------|
| `architecture` | アーキテクチャ設計書 | 800〜1200 | 開発者、テックリード |
| `use-cases` | ユースケース仕様書 | 400〜700 | 開発者、PO、QA |
| `overview` | プロジェクト概要書 | 300〜500 | 全ステークホルダー |
| `user-guide` | 利用者ガイド | 500〜800 | エンドユーザー、運用担当 |
| `api-reference` | APIリファレンス | 600〜1000 | 開発者 |
| `glossary` | 用語集 | 100〜300 | 全ステークホルダー |
| `deployment-guide` | デプロイメントガイド | 300〜600 | 運用担当、インフラ |

### 品質レベル別の処理範囲

| Phase | quick | standard | thorough |
|-------|-------|----------|----------|
| 1. レポート棚卸し | ファイル一覧のみ | 概要分析+カバレッジ評価 | 全文精読+矛盾検出 |
| 2. 情報抽出 | 主要情報のみ | 標準抽出（全カテゴリ） | 詳細抽出+推測情報の明示 |
| 3. 構造設計 | 標準テンプレート適用 | カスタマイズ構成 | プロジェクト固有の最適化構成 |
| 4. ドキュメント生成 | 最小限の図表 | Mermaid図+テーブル | 全図表+コード例+詳細説明 |
| 5. 整合性チェック | 用語統一のみ | 相互参照+用語+図 | 全項目+外部リンク検証 |
| 6. 品質保証 | 行数チェックのみ | 標準チェックリスト | 全チェック+レビュー観点 |

## Output Format

### 出力ディレクトリ構成

```
{output_dir}/
  architecture.md        # アーキテクチャ設計書
  use-cases.md           # ユースケース仕様書
  overview.md            # プロジェクト概要書
  user-guide.md          # 利用者ガイド
  generation-report.md   # 生成レポート（メタ情報）
```

### architecture.md テンプレート

```markdown
# {プロジェクト名} アーキテクチャ設計書

> **プロジェクト**: {プロジェクト名}
> **バージョン**: {version}
> **作成日**: {YYYY-MM-DD}
> **最終更新日**: {YYYY-MM-DD}
> **タスクID**: {parent_task_id}
> **作成者**: {author}
> **ステータス**: ドラフト

### 入力ソース

| レポートID | タイトル | 作成日 |
|-----------|---------|--------|
| O-001 | {タイトル} | {日付} |
| ... | ... | ... |

### 関連ドキュメント

| ドキュメント | 説明 |
|------------|------|
| [use-cases.md](./use-cases.md) | ユースケース仕様書 |
| [overview.md](./overview.md) | プロジェクト概要 |
| [user-guide.md](./user-guide.md) | 利用者ガイド |

---

## 目次

1. [エグゼクティブサマリ](#1-エグゼクティブサマリ)
2. [システム概要](#2-システム概要)
3. [アーキテクチャ概要](#3-アーキテクチャ概要)
4. [コンポーネント設計](#4-コンポーネント設計)
5. [データ設計](#5-データ設計)
6. [インフラストラクチャ](#6-インフラストラクチャ)
7. [セキュリティ設計](#7-セキュリティ設計)
8. [横断的関心事](#8-横断的関心事)
9. [技術的決定事項](#9-技術的決定事項)
10. [ロードマップ](#10-ロードマップ)
11. [参考資料](#11-参考資料)

---

## 1. エグゼクティブサマリ

{プロジェクトの技術的な結論を3〜5文で要約}

| 項目 | 内容 |
|------|------|
| **目的** | {1行の目的} |
| **主要技術** | {技術名1}, {技術名2}, ... |
| **アーキテクチャスタイル** | {アーキテクチャパターン名} |
| **デプロイメント** | {デプロイ先} |

---

## 2. システム概要

### 2.1 目的と背景

{プロジェクトの目的と背景の説明}

### 2.2 スコープ

{スコープ内とスコープ外の明記}

### 2.3 前提条件と制約

| # | 区分 | 内容 |
|---|------|------|
| 1 | 前提条件 | {前提条件} |
| 2 | 制約 | {制約事項} |

---

## 3. アーキテクチャ概要

### 3.1 アーキテクチャ原則

{設計原則の列挙}

### 3.2 全体構成図

```mermaid
graph TB
    {Mermaidによるアーキテクチャ全体図}
```

### 3.3 技術スタック

| カテゴリ | 技術 | バージョン | 選定理由 |
|---------|------|----------|---------|
| 言語 | {言語} | {バージョン} | {理由} |
| FW | {FW名} | {バージョン} | {理由} |

---

## 4. コンポーネント設計

### 4.1 コンポーネント一覧

| # | コンポーネント | 責務 | 技術 |
|---|-------------|------|------|

### 4.2 コンポーネント間の関係

```mermaid
graph LR
    {コンポーネント依存関係図}
```

### 4.3 各コンポーネントの詳細

{コンポーネントごとの詳細説明}

---

{以下、セクション5〜11まで同様のフォーマットで続く}
```

### use-cases.md テンプレート

```markdown
# {プロジェクト名} ユースケース仕様書

> {メタデータヘッダ — architecture.mdと同形式}

---

## 目次

{セクション一覧}

---

## 1. アクター定義

### 1.1 プライマリアクター

| # | アクター | 説明 | 主な目的 |
|---|---------|------|---------|
| 1 | {アクター名} | {説明} | {目的} |

### 1.2 セカンダリアクター

| # | アクター | 説明 | 関連 |
|---|---------|------|------|

---

## 2. ユースケース概要

### 2.1 ユースケース一覧

| UC-ID | ユースケース名 | アクター | 優先度 | フェーズ |
|-------|-------------|---------|--------|---------|

### 2.2 ユースケース図

```mermaid
graph LR
    {ユースケース図}
```

---

## 3. ユースケース詳細

### 3.1 UC-01: {ユースケース名}

{ユースケース詳細テンプレートに従って記述}

---

{以下、各ユースケースの詳細}

---

## 4. 非機能要件

{非機能要件の記述}

---

## 5. 参考資料

{参考資料リスト}
```

### generation-report.md テンプレート

```markdown
# ドキュメント生成レポート

> **生成日時**: {YYYY-MM-DD HH:MM}
> **タスクID**: {parent_task_id}
> **スキル**: S-013 nablarch-doc-generator

## 生成結果サマリ

| # | ファイル | 行数 | セクション数 | Mermaid図数 | テーブル数 | 状態 |
|---|---------|------|-----------|-----------|----------|------|
| 1 | architecture.md | {行数} | {数} | {数} | {数} | OK |
| 2 | use-cases.md | {行数} | {数} | {数} | {数} | OK |
| 3 | overview.md | {行数} | {数} | {数} | {数} | OK |
| 4 | user-guide.md | {行数} | {数} | {数} | {数} | OK |
| - | **合計** | **{合計}** | **{合計}** | **{合計}** | **{合計}** | |

## 入力レポート利用状況

| レポートID | 利用度 | 主な引用先 |
|-----------|--------|----------|
| O-001 | ◎ 主要 | architecture.md, overview.md |
| ... | ... | ... |

## 品質チェック結果

| チェック項目 | 結果 | 備考 |
|------------|------|------|
| 相互参照の整合性 | PASS / WARN | {備考} |
| 用語統一 | PASS / WARN | {備考} |
| Mermaid構文 | PASS / WARN | {備考} |
| メタデータ完全性 | PASS / WARN | {備考} |
| 行数範囲 | PASS / WARN | {備考} |

## 未解決事項

| # | 事項 | 影響ドキュメント | タグ |
|---|------|---------------|------|
| 1 | {未解決事項} | {ファイル名} | 【要追加調査】 |

## 用語集

{生成された用語集の一覧}

| 用語 | 定義 | 使用箇所 |
|------|------|---------|
```

## Examples

### Example 1: Nablarch MCPサーバーのドキュメントセット生成（実績ベース）

```
入力:
  project_name: "nablarch-mcp-server"
  input_reports:
    - "output/O-001_nablarch_mcp_server_plan.md"        # MCP構築計画（450行）
    - "output/O-002_nablarch_rag_system_plan.md"         # RAGシステム計画（380行）
    - "output/O-005_nablarch_kb_official_docs.md"        # 公式ドキュメントKB
    - "output/O-006_nablarch_kb_architecture.md"         # アーキテクチャKB
    - "output/O-022_nablarch_mcp_feasibility_study.md"   # 実装可能性調査
    - "output/O-023_nablarch_rag_mcp_analysis.md"        # RAG-MCP分析
  output_dir: "docs/"
  version: "1.0.0"
  parent_task_id: "cmd_017"
  author: "ashigaru7"
  quality_level: "standard"

Phase 1 — レポート棚卸し:
  - 6レポートを全て読み込み
  - O-022の「殿の方針決定」を最優先情報として特定
  - O-001とO-022の矛盾を検出（Nablarch実装 vs Spring Boot確定）→ O-022を採用

Phase 2 — 情報抽出:
  - アーキテクチャ情報: O-001（設計）、O-006（KB）、O-022（実装方式）
  - ユースケース情報: O-001（Tools/Resources）、O-023（RAG連携パターン）
  - 概要情報: O-001（目的）、O-002（RAG連携）、O-023（統合アプローチ）
  - 利用ガイド情報: O-005（公式ドキュメント構造）、O-006（KB構造）

Phase 3 — 構造設計:
  - 標準4ドキュメントセットを採用
  - architecture.mdにMCPサーバー固有のTools/Resources/Prompts設計セクションを追加

Phase 4 — ドキュメント生成:
  - architecture.md: 約1100行（Mermaid図5つ、テーブル12個）
  - use-cases.md: 約600行（UC-01〜UC-12、シーケンス図4つ）
  - overview.md: 約450行（用語集20項目）
  - user-guide.md: 約700行（クイックスタート、設定リファレンス）

Phase 5 — 整合性チェック:
  - 相互参照: 全32リンクが有効
  - 用語統一: 「MCPサーバー」に統一（「MCPサーバ」3箇所を修正）

Phase 6 — 品質保証:
  - 合計: 約2850行（推奨範囲内）
  - 全チェック項目PASS

出力サマリ:
  | # | ファイル | 行数 | Mermaid図 | テーブル |
  |---|---------|------|----------|---------|
  | 1 | architecture.md | 1100 | 5 | 12 |
  | 2 | use-cases.md | 600 | 4 | 8 |
  | 3 | overview.md | 450 | 2 | 6 |
  | 4 | user-guide.md | 700 | 1 | 10 |
  | - | **合計** | **2850** | **12** | **36** |
```

### Example 2: 小規模プロジェクトのドキュメント生成（quickモード）

```
入力:
  project_name: "nablarch-batch-trainer"
  input_reports:
    - "output/O-024_nablarch_batch_training.md"
  output_dir: "docs/batch-trainer/"
  documents:
    - type: "overview"
      filename: "overview.md"
    - type: "user-guide"
      filename: "user-guide.md"
  quality_level: "quick"

Phase 1 — レポート棚卸し:
  - 入力レポート1件のみ → 簡易棚卸し

Phase 2 — 情報抽出:
  - バッチ処理の学習コンテンツ、手順、前提条件を抽出

Phase 3 — 構造設計:
  - overview.mdとuser-guide.mdの2ドキュメントのみ

Phase 4 — ドキュメント生成:
  - overview.md: 約200行（簡潔な概要）
  - user-guide.md: 約400行（ステップバイステップの学習手順）

Phase 5-6 — 簡易チェックのみ

出力サマリ:
  | # | ファイル | 行数 |
  |---|---------|------|
  | 1 | overview.md | 200 |
  | 2 | user-guide.md | 400 |
  | - | **合計** | **600** |
```

### Example 3: 大規模プロジェクトの徹底的ドキュメント生成（thoroughモード）

```
入力:
  project_name: "nablarch-ai-platform"
  input_reports:
    - "output/O-001_nablarch_mcp_server_plan.md"
    - "output/O-002_nablarch_rag_system_plan.md"
    - "output/O-003_nablarch_handler_queue_tool_plan.md"
    - "output/O-004_nablarch_quality_gate_plan.md"
    - "output/O-005_nablarch_kb_official_docs.md"
    - "output/O-006_nablarch_kb_architecture.md"
    - "output/O-007_nablarch_kb_dev_standards.md"
    - "output/O-008_nablarch_kb_github.md"
    - "output/O-009_nablarch_kb_fintan.md"
    - "output/O-010_nablarch_kb_community.md"
    - "output/O-022_nablarch_mcp_feasibility_study.md"
    - "output/O-023_nablarch_rag_mcp_analysis.md"
    - "output/O-024_nablarch_batch_training.md"
  output_dir: "docs/platform/"
  documents:
    - type: "architecture"
      filename: "architecture.md"
    - type: "use-cases"
      filename: "use-cases.md"
    - type: "overview"
      filename: "overview.md"
    - type: "user-guide"
      filename: "user-guide.md"
    - type: "api-reference"
      filename: "api-reference.md"
    - type: "glossary"
      filename: "glossary.md"
    - type: "deployment-guide"
      filename: "deployment-guide.md"
  version: "1.0.0"
  quality_level: "thorough"

Phase 1 — レポート棚卸し:
  - 13レポートの全文精読
  - レポート間の矛盾3件を検出・解決
  - 情報カバレッジマトリクスの完全作成

Phase 2 — 情報抽出:
  - 全カテゴリの詳細抽出
  - 推測情報34件に「【推測】」タグ付与
  - 不足情報7件に「【要追加調査】」タグ付与

Phase 3 — 構造設計:
  - 7ドキュメントのカスタマイズ構成
  - プロジェクト固有セクションの追加

Phase 4 — ドキュメント生成:
  - architecture.md: 約1200行
  - use-cases.md: 約700行
  - overview.md: 約500行
  - user-guide.md: 約800行
  - api-reference.md: 約900行
  - glossary.md: 約250行
  - deployment-guide.md: 約500行

Phase 5 — 整合性チェック:
  - 全項目チェック + 外部リンク検証
  - 修正箇所12件

Phase 6 — 品質保証:
  - 全チェックリスト実施
  - レビュー観点の付記

出力サマリ:
  | # | ファイル | 行数 | Mermaid図 | テーブル |
  |---|---------|------|----------|---------|
  | 1 | architecture.md | 1200 | 7 | 15 |
  | 2 | use-cases.md | 700 | 5 | 10 |
  | 3 | overview.md | 500 | 3 | 8 |
  | 4 | user-guide.md | 800 | 2 | 12 |
  | 5 | api-reference.md | 900 | 3 | 20 |
  | 6 | glossary.md | 250 | 0 | 3 |
  | 7 | deployment-guide.md | 500 | 4 | 6 |
  | - | **合計** | **4850** | **24** | **74** |
```

## Guidelines

### 必須ルール

1. **入力レポートの情報を正確に反映すること**
   - レポートに記載された事実を改変してはならない
   - 「殿（上様）の方針決定」は最優先で反映する
   - 複数レポート間で矛盾がある場合、日付が新しいレポートの情報を採用する
   - 推測で情報を補完した場合は「【推測】」プレフィックスを必ず付記する

2. **情報のトレーサビリティを確保すること**
   - 各ドキュメントのメタデータに入力レポート一覧を記載する
   - 主要な情報には出典レポートIDを付記する（例: `(出典: O-001)`）
   - 情報の出典が不明な場合は「出典不明」と記載する

3. **相互参照の整合性を維持すること**
   - ドキュメント間のリンクは全て有効であること
   - 同じ概念に異なる名称を使わないこと
   - コンポーネント名、ユースケース名は全ドキュメントで統一すること

4. **Mermaidダイアグラムを適切に含めること**
   - architecture.md: 最低3つの図（全体構成、コンポーネント関係、デプロイメント）
   - use-cases.md: 最低2つの図（ユースケース図、主要フローのシーケンス図）
   - overview.md: 最低1つの図（簡略化した全体構成図）
   - Mermaidの構文は正しく、レンダリング可能であること

5. **メタデータ管理を徹底すること**
   - 全ドキュメントに統一フォーマットのメタデータヘッダを含める
   - バージョン番号は全ドキュメントで一致させる
   - 作成日・最終更新日を正確に記載する

6. **用語統一を徹底すること**
   - プロジェクト固有の用語は overview.md の用語集で定義する
   - 略語は初出時に正式名称を併記する
   - 日本語/英語の表記ゆれを排除する

7. **1ファイル = 1エージェントの原則を遵守すること（RACE-001回避）**
   - 複数エージェントで並列生成する場合、各エージェントは専用ファイルのみに出力する
   - 相互参照チェックは全ドキュメント生成完了後に1エージェントが実施する

8. **品質チェックリストを全て実施すること**
   - Phase 6の品質チェックリストを省略してはならない
   - チェック結果は generation-report.md に記録する

### 情報が不足している場合の対処法

```
【情報不足時のルール】

1. 入力レポートに情報がない場合
   - 「【要追加調査】」タグを付けて、不足内容を明記する
   - 推測で補完する場合は「【推測】」タグを付ける
   - 推測と事実を絶対に混同しない

2. 矛盾する情報がある場合
   - 日付が新しいレポートの情報を優先する
   - 「殿の方針決定」がある場合はそれを最優先とする
   - 矛盾の存在と解決方法を generation-report.md に記録する

3. 曖昧な情報がある場合
   - 複数の解釈が可能な場合は最も保守的な解釈を採用する
   - 「【要確認】この情報は{レポートID}の記述が曖昧なため、確認が必要」と注記する
```

### ドキュメント生成のコツ（実践知見）

1. **エグゼクティブサマリは最後に書く**
   - 全セクションを書き終えてから、最も重要な3〜5ポイントをまとめる
   - 忙しい読者がサマリだけで概要を把握できるようにする

2. **Mermaidダイアグラムは本文の前に配置する**
   - 図を先に見せてから詳細を説明すると理解しやすい
   - 図の直後に「上図は〜を示している」という説明文を入れる

3. **テーブルは情報の比較・一覧に最適**
   - 3項目以上の比較 → テーブル
   - 手順の説明 → 番号付きリスト
   - 特徴の列挙 → 箇条書き

4. **user-guide.mdはコピー&ペーストの利便性を重視する**
   - コマンドはコードブロックで囲む
   - 設定値はそのまま使える形式で記載する
   - パスやURLは絶対パスで記載する

5. **overview.mdは「エレベーターピッチ」を意識する**
   - 30秒で読める要約を冒頭に配置する
   - 技術者でない人にも伝わる言葉を使う
   - 図は1つだけ、最もインパクトのあるものを選ぶ

6. **architecture.mdは「判断の根拠」を重視する**
   - 「何を採用したか」だけでなく「なぜ採用したか」を記載する
   - 却下された選択肢も記録する（将来の参考になる）
   - 制約事項は明示的に記載する

### アンチパターン（避けるべきこと）

- **入力レポートの丸写し**: レポートの文章をそのままコピーする → 再構成・要約・統合して記述する
- **情報の改変**: レポートの結論や数値を変更する → 原文の情報を正確に反映する
- **推測の無断混入**: 推測で補完した情報に「【推測】」タグを付けない → 必ず明記する
- **相互参照の放置**: リンク切れや用語不統一を放置 → Phase 5で必ず検証する
- **Mermaid図なしのarchitecture.md**: テキストのみの設計書 → 必ず図を含める
- **メタデータヘッダの省略**: 入力ソースや関連ドキュメントを記載しない → トレーサビリティ確保のため必須
- **品質チェックの省略**: Phase 6を飛ばして出力 → 必ず全チェック項目を実施する
- **用語集なしのoverview.md**: 専門用語の定義がない → 読者の理解を妨げる
- **コマンド例なしのuser-guide.md**: 抽象的な説明のみ → 具体的なコマンド例を必ず含める
- **1つのファイルに複数エージェントが書き込む**: RACE-001の原因 → 1ファイル=1エージェント厳守
- **古い情報の優先**: 新しい方針決定を無視して古いレポートの情報を採用 → 日付の新しい情報を優先
- **過剰な詳細**: 全ドキュメントに同レベルの詳細を記載 → 対象読者に応じた粒度で記述する
